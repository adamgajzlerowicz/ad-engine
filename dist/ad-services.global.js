window.Wikia=window.Wikia||{},window.Wikia.adServices=function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=window.Wikia.adEngine},function(e,t,r){"use strict";r.r(t);var s=r(0);const i="executor";class n{constructor(){this.methods={}}register(e,t){s.utils.logger(i,`method ${e} registered`),this.methods[e]=t}execute(e,t,r){const n=this.methods[e];if("function"!=typeof n)throw Error(`${e} is not executable`);s.utils.logger(i,`executing ${e} method`,t.name,r),n(t,r)}executeMethods(e,t){Object.keys(t).forEach(r=>{const{result:s}=t[r],i=e.find(e=>e.name===r&&e.executable);if(!i)return;const n=i[`on_${s}`];n&&n.forEach(e=>this.execute(e,i,s))})}}const o="project-handler";class a{constructor(){this.projects={}}enable(e){s.utils.logger(o,`project ${e} enabled`),this.projects[e]=!0}isEnabled(e){return!!this.projects[e]}getEnabledModelsWithParams(e){const t=s.context.get("services.billTheLizard.projects"),r=s.context.get("services.billTheLizard.parameters"),i=[],n={};return Object.keys(t).filter(t=>this.isEnabled(t)&&e.includes(t)).forEach(e=>{let o=!0;t[e].forEach(t=>{s.utils.isProperGeo(t.countries,t.name)?(t.executable=o,o=!1,i.push(t),Object.assign(n,r[e])):t.executable=!1})}),{models:i,parameters:n}}}const c="bill-the-lizard";function l(e,t,r={},i=0,n){const o=new XMLHttpRequest,a=function(e){const t=[];return Object.keys(e).forEach(r=>{t.push(`${r}=${e[r]}`)}),encodeURI(t.join("&"))}(r),l=function(e,t,r){return`${e}/${t}?${r}`}(e,t,a);return s.events.emit(s.events.BILL_THE_LIZARD_REQUEST,{query:a,callId:n}),o.open("GET",l,!0),o.responseType="json",o.timeout=i,s.utils.logger(c,"timeout configured to",o.timeout),new Promise((e,t)=>{o.addEventListener("timeout",()=>{t(new Error("timeout")),s.utils.logger(c,"timed out")}),o.addEventListener("error",()=>{t(new Error("error")),s.utils.logger(c,"errored")}),o.onreadystatechange=function(){4===this.readyState&&200===this.status&&(s.utils.logger(c,"has response"),e(this.response))},o.send()})}s.events.registerEvent("BILL_THE_LIZARD_REQUEST"),s.events.registerEvent("BILL_THE_LIZARD_RESPONSE");class u{constructor(){this.executor=new n,this.statuses={},this.projectsHandler=new a,this.predictions=[],this.callCounter=0,this.targetedModelNames=new Set}call(e,t){if(!s.context.get("services.billTheLizard.enabled"))return s.utils.logger(c,"disabled"),new Promise((e,t)=>t(new Error("Disabled")));t||(this.callCounter+=1,t=this.callCounter);const r=s.context.get("services.billTheLizard.host"),i=s.context.get("services.billTheLizard.endpoint"),n=s.context.get("services.billTheLizard.timeout"),{models:o,parameters:a}=this.projectsHandler.getEnabledModelsWithParams(e);if(!o||o.length<1)return s.utils.logger(c,"no models to predict"),this.statuses[t]=u.NOT_USED,Promise.resolve({});o.filter(e=>e.dfp_targeting).forEach(e=>this.targetedModelNames.add(e.name));const d=function(e,t){const r=new Date,s=r.getDay()-1;return Object.assign({},{models:e.map(e=>e.name),h:r.getHours(),dow:-1===s?6:s},t)}(o,a);return s.utils.logger(c,"calling service",r,i,d,`callId: ${t}`),this.statuses[t]=u.TOO_LATE,l(r,i,d,n,t).catch(e=>("timeout"===e.message?this.statuses[t]=u.TIMEOUT:this.statuses[t]=u.FAILURE,Promise.reject(e))).then(e=>(function(e){return Object.keys(e).forEach(t=>{const r=s.utils.queryString.get(`bill.${t}`);r&&(e[t].result=parseInt(r,10))}),e})(e)).then(e=>{s.utils.logger(c,"service response OK",`callId: ${t}`),this.statuses[t]=u.ON_TIME;const r=this.getModelToResultMap(e);s.utils.logger(c,"predictions",r,`callId: ${t}`);const i=this.buildPredictions(o,r,t);return this.predictions.push(...i),this.setTargeting(),s.events.emit(s.events.BILL_THE_LIZARD_RESPONSE,{callId:t,response:this.serialize(t)}),this.executor.executeMethods(o,e),r}).catch(e=>(s.utils.logger(c,"service response",e.message,`callId: ${t}`),{}))}buildPredictions(e,t,r){return e.map(e=>e.name).filter(e=>void 0!==t[e]).map(e=>({modelName:e,callId:r,result:t[e]}))}getModelToResultMap(e){const t={};return Object.keys(e).forEach(r=>{const{result:s}=e[r];void 0!==s&&(t[r]=s)}),t}setTargeting(){const e=this.getTargeting();if(Object.keys(e).length>0){const t=Object.entries(e).map(([e,t])=>`${e}_${t}`);return s.context.set("targeting.btl",t),t}return""}getTargeting(){const e={};return this.predictions.filter(e=>this.targetedModelNames.has(e.modelName)).forEach(t=>{e[t.modelName]=t.result}),e}getPrediction(e,t){return this.getPredictions(e).find(e=>e.callId===t)}getPredictions(e){return e?this.predictions.filter(t=>t.modelName.split(":")[0]===e.split(":")[0]):this.predictions}getResponseStatus(e){return e=e||this.callCounter,this.statuses[e]}serialize(e){let{predictions:t}=this;return void 0!==e&&(t=t.filter(t=>t.callId===e)),t.map(e=>`${e.modelName}|${e.callId}=${e.result}`).join(";")}}u.FAILURE="failure",u.NOT_USED="not_used",u.ON_TIME="on_time",u.TIMEOUT="timeout",u.TOO_LATE="too_late";const d=new u,g="geo-edge",m="d3b02estmut877";const h=new class{call(){const e=s.context.get("services.geoEdge.id"),t=s.context.get("services.geoEdge.config");return s.context.get("services.geoEdge.enabled")&&e?(s.utils.logger(g,"loading"),window.grumi={cfg:t,key:e},function(){const e=`//${m}.cloudfront.net/grumi-ip.js`;return s.utils.scriptLoader.loadScript(e,"text/javascript",!0,"first")}().then(()=>{s.utils.logger(g,"ready")})):(s.utils.logger(g,"disabled"),Promise.resolve())}},p="krux";function f(e){if(window.localStorage)return window.localStorage[e];if(window.navigator.cookieEnabled){const t=document.cookie.match(`${e}=([^;]*)`);return t&&decodeURI(t[1])||""}return""}window.Krux=window.Krux||function(...e){window.Krux.q.push(e)},window.Krux.q=window.Krux.q||[];const x=new class{call(){return s.context.get("services.krux.enabled")&&s.context.get("options.trackingOptIn")?(s.utils.logger(p,"loading"),function(){const e=`//cdn.krxd.net/controltag?confid=${s.context.get("services.krux.id")}`;return s.utils.scriptLoader.loadScript(e,"text/javascript",!0,"first",{id:"krux-control-tag"})}().then(()=>{this.exportPageParams(),this.importUserData()})):(s.utils.logger(p,"disabled"),Promise.resolve())}exportPageParams(){Object.keys(s.context.get("targeting")).forEach(e=>{const t=s.context.get(`targeting.${e}`);t&&(window[`kruxDartParam_${e}`]=t)})}importUserData(){const e=f("kxuser"),t=f("kxsegs");s.context.set("targeting.kuid",e||null),s.context.set("targeting.ksg",t?t.split(","):[]),s.utils.logger(p,"data set",e,t)}getUserId(){return s.context.get("targeting.kuid")||null}getSegments(){return s.context.get("targeting.ksg")||[]}},w="moat-yi";s.events.registerEvent("MOAT_YI_READY");const E=new class{call(){if(!s.context.get("services.moatYi.enabled")||!s.context.get("services.moatYi.partnerCode"))return s.utils.logger(w,"disabled"),Promise.resolve();let e;const t=new Promise(t=>{e=t});return s.utils.logger(w,"loading"),window.moatYieldReady=(()=>{this.importPageParams(),e()}),s.context.set("targeting.m_data","waiting"),function(){const e=`//z.moatads.com/${s.context.get("services.moatYi.partnerCode")}/yi.js`;return s.utils.scriptLoader.loadScript(e,"text/javascript",!0,"first")}().then(()=>{s.utils.logger(w,"ready")}),t}importPageParams(){if(window.moatPrebidApi&&"function"==typeof window.moatPrebidApi.getMoatTargetingForPage){const e=window.moatPrebidApi.getMoatTargetingForPage()||{};s.context.set("targeting.m_data",e.m_data),s.events.emit(s.events.MOAT_YI_READY,`m_data=${e.m_data}`),s.utils.logger(w,"moatYieldReady",e)}}};r.d(t,"BillTheLizard",function(){return u}),r.d(t,"billTheLizard",function(){return d}),r.d(t,"geoEdge",function(){return h}),r.d(t,"krux",function(){return x}),r.d(t,"moatYi",function(){return E})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9XaWtpYS5hZFNlcnZpY2VzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL1dpa2lhLmFkU2VydmljZXMvZXh0ZXJuYWwge1wid2luZG93XCI6W1wiV2lraWFcIixcImFkRW5naW5lXCJdfSIsIndlYnBhY2s6Ly9XaWtpYS5hZFNlcnZpY2VzLy4vc3JjL2FkLXNlcnZpY2VzL2JpbGwtdGhlLWxpemFyZC9leGVjdXRvci50cyIsIndlYnBhY2s6Ly9XaWtpYS5hZFNlcnZpY2VzLy4vc3JjL2FkLXNlcnZpY2VzL2JpbGwtdGhlLWxpemFyZC9wcm9qZWN0cy1oYW5kbGVyLnRzIiwid2VicGFjazovL1dpa2lhLmFkU2VydmljZXMvLi9zcmMvYWQtc2VydmljZXMvYmlsbC10aGUtbGl6YXJkL2luZGV4LnRzIiwid2VicGFjazovL1dpa2lhLmFkU2VydmljZXMvLi9zcmMvYWQtc2VydmljZXMvZ2VvLWVkZ2UvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vV2lraWEuYWRTZXJ2aWNlcy8uL3NyYy9hZC1zZXJ2aWNlcy9rcnV4L2luZGV4LnRzIiwid2VicGFjazovL1dpa2lhLmFkU2VydmljZXMvLi9zcmMvYWQtc2VydmljZXMvbW9hdC15aS9pbmRleC50cyIsIndlYnBhY2s6Ly9XaWtpYS5hZFNlcnZpY2VzLy4vc3JjL2FkLXNlcnZpY2VzL2luZGV4LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJ3aW5kb3ciLCJsb2dHcm91cCIsImV4ZWN1dG9yX0V4ZWN1dG9yIiwiW29iamVjdCBPYmplY3RdIiwidGhpcyIsIm1ldGhvZHMiLCJjYWxsYmFjayIsImV4dGVybmFsX3dpbmRvd19XaWtpYV9hZEVuZ2luZV8iLCJsb2dnZXIiLCJtZXRob2ROYW1lIiwibW9kZWwiLCJwcmVkaWN0aW9uIiwiRXJyb3IiLCJtb2RlbHMiLCJyZXNwb25zZSIsImtleXMiLCJmb3JFYWNoIiwibW9kZWxOYW1lIiwicmVzdWx0IiwiZXhlY3V0YWJsZU1vZGVsIiwiZmluZCIsImV4ZWN1dGFibGUiLCJkZWZpbmVkTWV0aG9kcyIsImV4ZWN1dGUiLCJwcm9qZWN0c19oYW5kbGVyX2xvZ0dyb3VwIiwicHJvamVjdHNfaGFuZGxlcl9Qcm9qZWN0c0hhbmRsZXIiLCJwcm9qZWN0cyIsInByb2plY3ROYW1lcyIsInByb2plY3RQYXJhbWV0ZXJzIiwicGFyYW1ldGVycyIsImZpbHRlciIsImlzRW5hYmxlZCIsImluY2x1ZGVzIiwiaXNOZXh0TW9kZWxFeGVjdXRhYmxlIiwiaXNQcm9wZXJHZW8iLCJjb3VudHJpZXMiLCJwdXNoIiwiYXNzaWduIiwiYmlsbF90aGVfbGl6YXJkX2xvZ0dyb3VwIiwiaHR0cFJlcXVlc3QiLCJob3N0IiwiZW5kcG9pbnQiLCJxdWVyeVBhcmFtZXRlcnMiLCJ0aW1lb3V0IiwiY2FsbElkIiwicmVxdWVzdCIsIlhNTEh0dHBSZXF1ZXN0IiwicXVlcnkiLCJwYXJhbXMiLCJrZXkiLCJlbmNvZGVVUkkiLCJqb2luIiwiYnVpbGRRdWVyeVVybCIsInVybCIsImJ1aWxkVXJsIiwiZW1pdCIsIkJJTExfVEhFX0xJWkFSRF9SRVFVRVNUIiwib3BlbiIsInJlc3BvbnNlVHlwZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJzZW5kIiwicmVnaXN0ZXJFdmVudCIsImJpbGxfdGhlX2xpemFyZF9CaWxsVGhlTGl6YXJkIiwiZXhlY3V0b3IiLCJzdGF0dXNlcyIsInByb2plY3RzSGFuZGxlciIsInByZWRpY3Rpb25zIiwiY2FsbENvdW50ZXIiLCJ0YXJnZXRlZE1vZGVsTmFtZXMiLCJTZXQiLCJnZXRFbmFibGVkTW9kZWxzV2l0aFBhcmFtcyIsImxlbmd0aCIsIk5PVF9VU0VEIiwiZGZwX3RhcmdldGluZyIsImFkZCIsIm5vdyIsIkRhdGUiLCJkYXkiLCJnZXREYXkiLCJtYXAiLCJoIiwiZ2V0SG91cnMiLCJkb3ciLCJnZXRRdWVyeVBhcmFtZXRlcnMiLCJUT09fTEFURSIsImNhdGNoIiwiZXJyb3IiLCJtZXNzYWdlIiwiVElNRU9VVCIsIkZBSUxVUkUiLCJ0aGVuIiwibmV3VmFsdWUiLCJxdWVyeVN0cmluZyIsInBhcnNlSW50Iiwib3ZlcnJpZGVQcmVkaWN0aW9ucyIsIk9OX1RJTUUiLCJtb2RlbFRvUmVzdWx0TWFwIiwiZ2V0TW9kZWxUb1Jlc3VsdE1hcCIsImJ1aWxkUHJlZGljdGlvbnMiLCJzZXRUYXJnZXRpbmciLCJCSUxMX1RIRV9MSVpBUkRfUkVTUE9OU0UiLCJzZXJpYWxpemUiLCJleGVjdXRlTWV0aG9kcyIsInVuZGVmaW5lZCIsInRhcmdldGluZyIsImdldFRhcmdldGluZyIsInNlcmlhbGl6ZWRUYXJnZXRpbmciLCJlbnRyaWVzIiwic2V0IiwibGF0ZXN0UmVzdWx0cyIsInByZWQiLCJoYXMiLCJnZXRQcmVkaWN0aW9ucyIsInNwbGl0IiwiYmlsbFRoZUxpemFyZCIsImdlb19lZGdlX2xvZ0dyb3VwIiwic2NyaXB0RG9tYWluSWQiLCJnZW9FZGdlIiwiZ2VvRWRnZUtleSIsImdlb0VkZ2VDb25maWciLCJncnVtaSIsImNmZyIsImdlb0VkZ2VMaWJyYXJ5VXJsIiwic2NyaXB0TG9hZGVyIiwibG9hZFNjcmlwdCIsImtydXhfbG9nR3JvdXAiLCJnZXRLcnV4RGF0YSIsImxvY2FsU3RvcmFnZSIsIm5hdmlnYXRvciIsImNvb2tpZUVuYWJsZWQiLCJtYXRjaCIsImRvY3VtZW50IiwiY29va2llIiwiZGVjb2RlVVJJIiwiS3J1eCIsImFyZ3MiLCJxIiwia3J1eCIsImtydXhMaWJyYXJ5VXJsIiwiaWQiLCJrcnV4X2xvYWRTY3JpcHQiLCJleHBvcnRQYWdlUGFyYW1zIiwiaW1wb3J0VXNlckRhdGEiLCJ1c2VyIiwic2VnbWVudHMiLCJtb2F0X3lpX2xvZ0dyb3VwIiwibW9hdFlpIiwibW9hdFllaWxkUmVhZHlSZXNvbHZlIiwicHJvbWlzZSIsIm1vYXRZaWVsZFJlYWR5IiwiaW1wb3J0UGFnZVBhcmFtcyIsIm1vYXRfeWlfbG9hZFNjcmlwdCIsIm1vYXRQcmViaWRBcGkiLCJnZXRNb2F0VGFyZ2V0aW5nRm9yUGFnZSIsInBhZ2VQYXJhbXMiLCJtX2RhdGEiLCJNT0FUX1lJX1JFQURZIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJtYXBwaW5ncyI6ImtFQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUEyQ0EsT0F0Q0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFaLEVBQUFtQixFQUFBLFNBQUFqQixHQUNBWSxPQUFBQyxlQUFBYixFQUFBLGNBQWlEa0IsT0FBQSxLQUlqRHBCLEVBQUFxQixFQUFBLFNBQUFsQixHQUNBLElBQUFTLEVBQUFULEtBQUFtQixXQUNBLFdBQTJCLE9BQUFuQixFQUFBLFNBQzNCLFdBQWlDLE9BQUFBLEdBRWpDLE9B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Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsIihmdW5jdGlvbigpIHsgbW9kdWxlLmV4cG9ydHMgPSB3aW5kb3dbXCJXaWtpYVwiXVtcImFkRW5naW5lXCJdOyB9KCkpOyIsImltcG9ydCB7IHV0aWxzIH0gZnJvbSAnQHdpa2lhL2FkLWVuZ2luZSc7XG5jb25zdCBsb2dHcm91cCA9ICdleGVjdXRvcic7XG4vKipcbiAqIEJpbGwgdGhlIExpemFyZCBtZXRob2RzIGV4ZWN1dG9yXG4gKi9cbmV4cG9ydCBjbGFzcyBFeGVjdXRvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMubWV0aG9kcyA9IHt9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcmVzIG5ldyBtZXRob2RcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICovXG4gICAgcmVnaXN0ZXIobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCBgbWV0aG9kICR7bmFtZX0gcmVnaXN0ZXJlZGApO1xuICAgICAgICB0aGlzLm1ldGhvZHNbbmFtZV0gPSBjYWxsYmFjaztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZXMgbWV0aG9kIGJ5IG5hbWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kTmFtZVxuICAgICAqIEBwYXJhbSB7TW9kZWxEZWZpbml0aW9ufSBtb2RlbFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfHVuZGVmaW5lZH0gcHJlZGljdGlvblxuICAgICAqL1xuICAgIGV4ZWN1dGUobWV0aG9kTmFtZSwgbW9kZWwsIHByZWRpY3Rpb24pIHtcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLm1ldGhvZHNbbWV0aG9kTmFtZV07XG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKGAke21ldGhvZE5hbWV9IGlzIG5vdCBleGVjdXRhYmxlYCk7XG4gICAgICAgIH1cbiAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCBgZXhlY3V0aW5nICR7bWV0aG9kTmFtZX0gbWV0aG9kYCwgbW9kZWwubmFtZSwgcHJlZGljdGlvbik7XG4gICAgICAgIGNhbGxiYWNrKG1vZGVsLCBwcmVkaWN0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZXMgYWxsIG1ldGhvZHMgZGVmaW5lZCBpbiBnaXZlbiBtb2RlbCBiYXNlZCBvbiBzZXJ2aWNlIHJlc3BvbnNlXG4gICAgICogQHBhcmFtIHtNb2RlbERlZmluaXRpb25bXX0gbW9kZWxzXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gICAgICovXG4gICAgZXhlY3V0ZU1ldGhvZHMobW9kZWxzLCByZXNwb25zZSkge1xuICAgICAgICBPYmplY3Qua2V5cyhyZXNwb25zZSkuZm9yRWFjaCgobW9kZWxOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdCB9ID0gcmVzcG9uc2VbbW9kZWxOYW1lXTtcbiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGFibGVNb2RlbCA9IG1vZGVscy5maW5kKG1vZGVsID0+IG1vZGVsLm5hbWUgPT09IG1vZGVsTmFtZSAmJiBtb2RlbC5leGVjdXRhYmxlKTtcbiAgICAgICAgICAgIGlmICghZXhlY3V0YWJsZU1vZGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZGVmaW5lZE1ldGhvZHMgPSBleGVjdXRhYmxlTW9kZWxbYG9uXyR7cmVzdWx0fWBdO1xuICAgICAgICAgICAgaWYgKCFkZWZpbmVkTWV0aG9kcykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmluZWRNZXRob2RzLmZvckVhY2gobWV0aG9kTmFtZSA9PiB0aGlzLmV4ZWN1dGUobWV0aG9kTmFtZSwgZXhlY3V0YWJsZU1vZGVsLCByZXN1bHQpKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgY29udGV4dCwgdXRpbHMgfSBmcm9tICdAd2lraWEvYWQtZW5naW5lJztcbmNvbnN0IGxvZ0dyb3VwID0gJ3Byb2plY3QtaGFuZGxlcic7XG4vKipcbiAqIEJpbGwgdGhlIExpemFyZCBwcm9qZWN0cyBoYW5kbGVyXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9qZWN0c0hhbmRsZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnByb2plY3RzID0ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuYWJsZXMgcHJvamVjdCBieSBuYW1lXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAgICAgKi9cbiAgICBlbmFibGUobmFtZSkge1xuICAgICAgICB1dGlscy5sb2dnZXIobG9nR3JvdXAsIGBwcm9qZWN0ICR7bmFtZX0gZW5hYmxlZGApO1xuICAgICAgICB0aGlzLnByb2plY3RzW25hbWVdID0gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHdoZXRoZXIgcHJvamVjdCBpcyBlbmFibGVkXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBpc0VuYWJsZWQobmFtZSkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnByb2plY3RzW25hbWVdO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFsbCBnZW8tZW5hYmxlZCBtb2RlbHMnIGRlZmluaXRpb25zIGJhc2VkIG9uIGVuYWJsZWQgcHJvamVjdHNcbiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBwcm9qZWN0TmFtZXNcbiAgICAgKiBAcmV0dXJucyB7e21vZGVsczogTW9kZWxEZWZpbml0aW9uW10sIHBhcmFtZXRlcnM6IE9iamVjdH19XG4gICAgICovXG4gICAgZ2V0RW5hYmxlZE1vZGVsc1dpdGhQYXJhbXMocHJvamVjdE5hbWVzKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gY29udGV4dC5nZXQoJ3NlcnZpY2VzLmJpbGxUaGVMaXphcmQucHJvamVjdHMnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFBhcmFtZXRlcnMgPSBjb250ZXh0LmdldCgnc2VydmljZXMuYmlsbFRoZUxpemFyZC5wYXJhbWV0ZXJzJyk7XG4gICAgICAgIGNvbnN0IGVuYWJsZWRQcm9qZWN0TmFtZXMgPSBPYmplY3Qua2V5cyhwcm9qZWN0cylcbiAgICAgICAgICAgIC5maWx0ZXIobmFtZSA9PiAodGhpcy5pc0VuYWJsZWQobmFtZSkgJiYgcHJvamVjdE5hbWVzLmluY2x1ZGVzKG5hbWUpKSk7XG4gICAgICAgIGNvbnN0IG1vZGVscyA9IFtdO1xuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0ge307XG4gICAgICAgIGVuYWJsZWRQcm9qZWN0TmFtZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgICAgICAgICAgLy8gT25seSBmaXJzdCBlbmFibGVkIG1vZGVsIGluIHByb2plY3QgaXMgZXhlY3V0YWJsZVxuICAgICAgICAgICAgbGV0IGlzTmV4dE1vZGVsRXhlY3V0YWJsZSA9IHRydWU7XG4gICAgICAgICAgICBwcm9qZWN0c1tuYW1lXS5mb3JFYWNoKChtb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1dGlscy5pc1Byb3Blckdlbyhtb2RlbC5jb3VudHJpZXMsIG1vZGVsLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGVsLmV4ZWN1dGFibGUgPSBpc05leHRNb2RlbEV4ZWN1dGFibGU7XG4gICAgICAgICAgICAgICAgICAgIGlzTmV4dE1vZGVsRXhlY3V0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBtb2RlbHMucHVzaChtb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFyYW1ldGVycywgcHJvamVjdFBhcmFtZXRlcnNbbmFtZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWwuZXhlY3V0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1vZGVscyxcbiAgICAgICAgICAgIHBhcmFtZXRlcnNcbiAgICAgICAgfTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBjb250ZXh0LCBldmVudHMsIHV0aWxzIH0gZnJvbSAnQHdpa2lhL2FkLWVuZ2luZSc7XG5pbXBvcnQgeyBFeGVjdXRvciB9IGZyb20gJy4vZXhlY3V0b3InO1xuaW1wb3J0IHsgUHJvamVjdHNIYW5kbGVyIH0gZnJvbSAnLi9wcm9qZWN0cy1oYW5kbGVyJztcbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gTW9kZWxEZWZpbml0aW9uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW58dW5kZWZpbmVkfSBleGVjdXRhYmxlXG4gKiBAcHJvcGVydHkge3N0cmluZ1tdfSBjb3VudHJpZXNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lXG4gKiBAcHJvcGVydHkge2Z1bmN0aW9ufSBvbl8qXG4gKi9cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUHJlZGljdGlvbkRlZmluaXRpb25cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBtb2RlbE5hbWVcbiAqIEBwcm9wZXJ0eSB7cmVzdWx0fSBudW1iZXJcbiAqIEBwcm9wZXJ0eSB7KG51bWJlcnxzdHJpbmcpfSBjYWxsSWRcbiAqL1xuY29uc3QgbG9nR3JvdXAgPSAnYmlsbC10aGUtbGl6YXJkJztcbmV2ZW50cy5yZWdpc3RlckV2ZW50KCdCSUxMX1RIRV9MSVpBUkRfUkVRVUVTVCcpO1xuZXZlbnRzLnJlZ2lzdGVyRXZlbnQoJ0JJTExfVEhFX0xJWkFSRF9SRVNQT05TRScpO1xuLyoqXG4gKiBCdWlsZHMgcXVlcnkgcGFyYW1ldGVycyBmb3IgdXJsXG4gKiBAcGFyYW0ge09iamVjdH0gcXVlcnlQYXJhbWV0ZXJzIChrZXktdmFsdWUgcGFpcnMgZm9yIHF1ZXJ5IHBhcmFtZXRlcnMpXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBidWlsZFF1ZXJ5VXJsKHF1ZXJ5UGFyYW1ldGVycykge1xuICAgIGNvbnN0IHBhcmFtcyA9IFtdO1xuICAgIE9iamVjdC5rZXlzKHF1ZXJ5UGFyYW1ldGVycykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIHBhcmFtcy5wdXNoKGAke2tleX09JHtxdWVyeVBhcmFtZXRlcnNba2V5XX1gKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZW5jb2RlVVJJKHBhcmFtcy5qb2luKCcmJykpO1xufVxuLyoqXG4gKiBCdWlsZHMgZW5kcG9pbnQgdXJsXG4gKiBAcGFyYW0ge3N0cmluZ30gaG9zdFxuICogQHBhcmFtIHtzdHJpbmd9IGVuZHBvaW50XG4gKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGJ1aWxkVXJsKGhvc3QsIGVuZHBvaW50LCBxdWVyeSkge1xuICAgIHJldHVybiBgJHtob3N0fS8ke2VuZHBvaW50fT8ke3F1ZXJ5fWA7XG59XG4vKipcbiAqIFJlcXVlc3RzIHNlcnZpY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBob3N0XG4gKiBAcGFyYW0ge3N0cmluZ30gZW5kcG9pbnRcbiAqIEBwYXJhbSB7T2JqZWN0fSBxdWVyeVBhcmFtZXRlcnMgKGtleS12YWx1ZSBwYWlycyBmb3IgcXVlcnkgcGFyYW1ldGVycylcbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0XG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGNhbGxJZFxuICogQHJldHVybnMge1Byb21pc2V9XG4gKi9cbmZ1bmN0aW9uIGh0dHBSZXF1ZXN0KGhvc3QsIGVuZHBvaW50LCBxdWVyeVBhcmFtZXRlcnMgPSB7fSwgdGltZW91dCA9IDAsIGNhbGxJZCkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICBjb25zdCBxdWVyeSA9IGJ1aWxkUXVlcnlVcmwocXVlcnlQYXJhbWV0ZXJzKTtcbiAgICBjb25zdCB1cmwgPSBidWlsZFVybChob3N0LCBlbmRwb2ludCwgcXVlcnkpO1xuICAgIGV2ZW50cy5lbWl0KGV2ZW50cy5CSUxMX1RIRV9MSVpBUkRfUkVRVUVTVCwge1xuICAgICAgICBxdWVyeSxcbiAgICAgICAgY2FsbElkLFxuICAgIH0pO1xuICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCB0cnVlKTtcbiAgICByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9ICdqc29uJztcbiAgICByZXF1ZXN0LnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ3RpbWVvdXQgY29uZmlndXJlZCB0bycsIHJlcXVlc3QudGltZW91dCk7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCd0aW1lb3V0JywgKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigndGltZW91dCcpKTtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ3RpbWVkIG91dCcpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHtcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ2Vycm9yJykpO1xuICAgICAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCAnZXJyb3JlZCcpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmIHRoaXMuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICB1dGlscy5sb2dnZXIobG9nR3JvdXAsICdoYXMgcmVzcG9uc2UnKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMucmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXF1ZXN0LnNlbmQoKTtcbiAgICB9KTtcbn1cbi8qKlxuICogQnVpbGRzIGtleS12YWx1ZSBwYWlycyBmb3IgcXVlcnkgcGFyYW1ldGVyc1xuICogQHBhcmFtIHtNb2RlbERlZmluaXRpb25bXX0gbW9kZWxzXG4gKiBAcGFyYW0ge09iamVjdH0gcGFyYW1ldGVycyAoa2V5LXZhbHVlIHBhaXJzKVxuICogQHJldHVybnMge09iamVjdH1cbiAqL1xuZnVuY3Rpb24gZ2V0UXVlcnlQYXJhbWV0ZXJzKG1vZGVscywgcGFyYW1ldGVycykge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGF5ID0gbm93LmdldERheSgpIC0gMTtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwge1xuICAgICAgICBtb2RlbHM6IG1vZGVscy5tYXAobW9kZWwgPT4gbW9kZWwubmFtZSksXG4gICAgICAgIGg6IG5vdy5nZXRIb3VycygpLFxuICAgICAgICBkb3c6IGRheSA9PT0gLTEgPyA2IDogZGF5XG4gICAgfSwgcGFyYW1ldGVycyk7XG59XG4vKipcbiAqIE92ZXJyaWRlcyBwcmVkaWN0aW9ucyBiYXNlZCBvbiByZXNwb25zZVxuICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gKiBAcmV0dXJucyB7T2JqZWN0fVxuICovXG5mdW5jdGlvbiBvdmVycmlkZVByZWRpY3Rpb25zKHJlc3BvbnNlKSB7XG4gICAgT2JqZWN0LmtleXMocmVzcG9uc2UpLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSB1dGlscy5xdWVyeVN0cmluZy5nZXQoYGJpbGwuJHtuYW1lfWApO1xuICAgICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlW25hbWVdLnJlc3VsdCA9IHBhcnNlSW50KG5ld1ZhbHVlLCAxMCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG4vKipcbiAqIEJpbGwgdGhlIExpemFyZCBzZXJ2aWNlIGhhbmRsZXJcbiAqL1xuZXhwb3J0IGNsYXNzIEJpbGxUaGVMaXphcmQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmV4ZWN1dG9yID0gbmV3IEV4ZWN1dG9yKCk7XG4gICAgICAgIHRoaXMuc3RhdHVzZXMgPSB7fTtcbiAgICAgICAgdGhpcy5wcm9qZWN0c0hhbmRsZXIgPSBuZXcgUHJvamVjdHNIYW5kbGVyKCk7XG4gICAgICAgIHRoaXMucHJlZGljdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5jYWxsQ291bnRlciA9IDA7XG4gICAgICAgIHRoaXMudGFyZ2V0ZWRNb2RlbE5hbWVzID0gbmV3IFNldCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXF1ZXN0cyBzZXJ2aWNlLCBleGVjdXRlcyBkZWZpbmVkIG1ldGhvZHMgYW5kIHBhcnNlcyByZXNwb25zZVxuICAgICAqXG4gICAgICogU3VwcGx5IGNhbGxLZXkgaWYgeW91IG5lZWQgdG8gYWNjZXNzIHN0YXR1cyBmb3IgdGhpcyBzcGVjaWZpYyByZXF1ZXN0LlxuICAgICAqIERPIE5PVCB1c2UgYW4gaW50ZWdlciBhcyBjYWxsS2V5IGFzIGl0J3MgdGhlIGRlZmF1bHQgdmFsdWUuXG4gICAgICogR29vZCBrZXkgZXhhbXBsZTogXCJpbmNvbnRlbnRfYm94YWQxXCIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBwcm9qZWN0TmFtZXNcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2FsbElkIGtleSBmb3IgdGhpcyBjYWxsXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY2FsbChwcm9qZWN0TmFtZXMsIGNhbGxJZCkge1xuICAgICAgICBpZiAoIWNvbnRleHQuZ2V0KCdzZXJ2aWNlcy5iaWxsVGhlTGl6YXJkLmVuYWJsZWQnKSkge1xuICAgICAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiByZWplY3QobmV3IEVycm9yKCdEaXNhYmxlZCcpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjYWxsSWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsbENvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgIGNhbGxJZCA9IHRoaXMuY2FsbENvdW50ZXI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaG9zdCA9IGNvbnRleHQuZ2V0KCdzZXJ2aWNlcy5iaWxsVGhlTGl6YXJkLmhvc3QnKTtcbiAgICAgICAgY29uc3QgZW5kcG9pbnQgPSBjb250ZXh0LmdldCgnc2VydmljZXMuYmlsbFRoZUxpemFyZC5lbmRwb2ludCcpO1xuICAgICAgICBjb25zdCB0aW1lb3V0ID0gY29udGV4dC5nZXQoJ3NlcnZpY2VzLmJpbGxUaGVMaXphcmQudGltZW91dCcpO1xuICAgICAgICBjb25zdCB7IG1vZGVscywgcGFyYW1ldGVycyB9ID0gdGhpcy5wcm9qZWN0c0hhbmRsZXIuZ2V0RW5hYmxlZE1vZGVsc1dpdGhQYXJhbXMocHJvamVjdE5hbWVzKTtcbiAgICAgICAgaWYgKCFtb2RlbHMgfHwgbW9kZWxzLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ25vIG1vZGVscyB0byBwcmVkaWN0Jyk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c2VzW2NhbGxJZF0gPSBCaWxsVGhlTGl6YXJkLk5PVF9VU0VEO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7fSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdXBkYXRlIG5hbWVzIG9mIEdBTSB0YXJnZXRlZCBtb2RlbHNcbiAgICAgICAgbW9kZWxzXG4gICAgICAgICAgICAuZmlsdGVyKG1vZGVsID0+IG1vZGVsLmRmcF90YXJnZXRpbmcpXG4gICAgICAgICAgICAuZm9yRWFjaChtb2RlbCA9PiB0aGlzLnRhcmdldGVkTW9kZWxOYW1lcy5hZGQobW9kZWwubmFtZSkpO1xuICAgICAgICBjb25zdCBxdWVyeVBhcmFtZXRlcnMgPSBnZXRRdWVyeVBhcmFtZXRlcnMobW9kZWxzLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCAnY2FsbGluZyBzZXJ2aWNlJywgaG9zdCwgZW5kcG9pbnQsIHF1ZXJ5UGFyYW1ldGVycywgYGNhbGxJZDogJHtjYWxsSWR9YCk7XG4gICAgICAgIHRoaXMuc3RhdHVzZXNbY2FsbElkXSA9IEJpbGxUaGVMaXphcmQuVE9PX0xBVEU7XG4gICAgICAgIHJldHVybiBodHRwUmVxdWVzdChob3N0LCBlbmRwb2ludCwgcXVlcnlQYXJhbWV0ZXJzLCB0aW1lb3V0LCBjYWxsSWQpXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyb3IubWVzc2FnZSA9PT0gJ3RpbWVvdXQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNlc1tjYWxsSWRdID0gQmlsbFRoZUxpemFyZC5USU1FT1VUO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNlc1tjYWxsSWRdID0gQmlsbFRoZUxpemFyZC5GQUlMVVJFO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IG92ZXJyaWRlUHJlZGljdGlvbnMocmVzcG9uc2UpKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICB1dGlscy5sb2dnZXIobG9nR3JvdXAsICdzZXJ2aWNlIHJlc3BvbnNlIE9LJywgYGNhbGxJZDogJHtjYWxsSWR9YCk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c2VzW2NhbGxJZF0gPSBCaWxsVGhlTGl6YXJkLk9OX1RJTUU7XG4gICAgICAgICAgICBjb25zdCBtb2RlbFRvUmVzdWx0TWFwID0gdGhpcy5nZXRNb2RlbFRvUmVzdWx0TWFwKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ3ByZWRpY3Rpb25zJywgbW9kZWxUb1Jlc3VsdE1hcCwgYGNhbGxJZDogJHtjYWxsSWR9YCk7XG4gICAgICAgICAgICBjb25zdCBwcmVkaWN0aW9ucyA9IHRoaXMuYnVpbGRQcmVkaWN0aW9ucyhtb2RlbHMsIG1vZGVsVG9SZXN1bHRNYXAsIGNhbGxJZCk7XG4gICAgICAgICAgICB0aGlzLnByZWRpY3Rpb25zLnB1c2goLi4ucHJlZGljdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5zZXRUYXJnZXRpbmcoKTtcbiAgICAgICAgICAgIGV2ZW50cy5lbWl0KGV2ZW50cy5CSUxMX1RIRV9MSVpBUkRfUkVTUE9OU0UsIHtcbiAgICAgICAgICAgICAgICBjYWxsSWQsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMuc2VyaWFsaXplKGNhbGxJZCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZXhlY3V0b3IuZXhlY3V0ZU1ldGhvZHMobW9kZWxzLCByZXNwb25zZSk7XG4gICAgICAgICAgICByZXR1cm4gbW9kZWxUb1Jlc3VsdE1hcDtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ3NlcnZpY2UgcmVzcG9uc2UnLCBlcnJvci5tZXNzYWdlLCBgY2FsbElkOiAke2NhbGxJZH1gKTtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtNb2RlbERlZmluaXRpb25bXX0gbW9kZWxzXG4gICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywgbnVtYmVyPn0gbW9kZWxUb1Jlc3VsdE1hcFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gY2FsbElkXG4gICAgICogQHJldHVybnMge1ByZWRpY3Rpb25EZWZpbml0aW9uW119XG4gICAgICovXG4gICAgYnVpbGRQcmVkaWN0aW9ucyhtb2RlbHMsIG1vZGVsVG9SZXN1bHRNYXAsIGNhbGxJZCkge1xuICAgICAgICByZXR1cm4gbW9kZWxzXG4gICAgICAgICAgICAubWFwKG1vZGVsID0+IG1vZGVsLm5hbWUpXG4gICAgICAgICAgICAuZmlsdGVyKG1vZGVsTmFtZSA9PiBtb2RlbFRvUmVzdWx0TWFwW21vZGVsTmFtZV0gIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIC5tYXAobW9kZWxOYW1lID0+ICh7IG1vZGVsTmFtZSwgY2FsbElkLCByZXN1bHQ6IG1vZGVsVG9SZXN1bHRNYXBbbW9kZWxOYW1lXSB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHJlc3BvbnNlIHRvIHByZWRpY3Rpb25zXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gICAgICogQHJldHVybnMge1ByZWRpY3Rpb25EZWZpbml0aW9ufVxuICAgICAqL1xuICAgIGdldE1vZGVsVG9SZXN1bHRNYXAocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc3QgbW9kZWxUb1Jlc3VsdE1hcCA9IHt9O1xuICAgICAgICBPYmplY3Qua2V5cyhyZXNwb25zZSkuZm9yRWFjaCgobW9kZWxOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdCB9ID0gcmVzcG9uc2VbbW9kZWxOYW1lXTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIG1vZGVsVG9SZXN1bHRNYXBbbW9kZWxOYW1lXSA9IHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBtb2RlbFRvUmVzdWx0TWFwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIERGUCB0YXJnZXRpbmcgaW4gY29udGV4dC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHN0cmluZ1xuICAgICAqL1xuICAgIHNldFRhcmdldGluZygpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0aW5nID0gdGhpcy5nZXRUYXJnZXRpbmcoKTtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRhcmdldGluZykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgc2VyaWFsaXplZFRhcmdldGluZyA9IE9iamVjdC5lbnRyaWVzKHRhcmdldGluZylcbiAgICAgICAgICAgICAgICAubWFwKChbbW9kZWxOYW1lLCByZXN1bHRdKSA9PiBgJHttb2RlbE5hbWV9XyR7cmVzdWx0fWApO1xuICAgICAgICAgICAgY29udGV4dC5zZXQoJ3RhcmdldGluZy5idGwnLCBzZXJpYWxpemVkVGFyZ2V0aW5nKTtcbiAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVkVGFyZ2V0aW5nO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBtYXAgb2YgdGFyZ2V0ZWQgbW9kZWxzIHRvIHRoZWlyIHJlc3VsdHMuXG4gICAgICpcbiAgICAgKiBGb3IgZWFjaCBtb2RlbCwgaXQgdGFrZXMgdGhlIGxhdGVzdCByZXN1bHQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsIG51bWJlcj59XG4gICAgICovXG4gICAgZ2V0VGFyZ2V0aW5nKCkge1xuICAgICAgICBjb25zdCBsYXRlc3RSZXN1bHRzID0ge307XG4gICAgICAgIHRoaXMucHJlZGljdGlvbnNcbiAgICAgICAgICAgIC5maWx0ZXIocHJlZCA9PiB0aGlzLnRhcmdldGVkTW9kZWxOYW1lcy5oYXMocHJlZC5tb2RlbE5hbWUpKVxuICAgICAgICAgICAgLmZvckVhY2goKHByZWQpID0+IHtcbiAgICAgICAgICAgIGxhdGVzdFJlc3VsdHNbcHJlZC5tb2RlbE5hbWVdID0gcHJlZC5yZXN1bHQ7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbGF0ZXN0UmVzdWx0cztcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHByZWRpY3Rpb24gYnkgbW9kZWxOYW1lIGFuZCBjYWxsSWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZWxOYW1lXG4gICAgICogQHBhcmFtIHsobnVtYmVyfHN0cmluZyl9IGNhbGxJZFxuICAgICAqIEByZXR1cm5zIHtQcmVkaWN0aW9uRGVmaW5pdGlvbn1cbiAgICAgKi9cbiAgICBnZXRQcmVkaWN0aW9uKG1vZGVsTmFtZSwgY2FsbElkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFByZWRpY3Rpb25zKG1vZGVsTmFtZSkuZmluZChwcmVkID0+IHByZWQuY2FsbElkID09PSBjYWxsSWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHByZWRpY3Rpb25zIG9wdGlvbmFsbHkgZmlsdGVyZWQgYnkgbW9kZWwgbmFtZS5cbiAgICAgKlxuICAgICAqIElmIG1vZGVsIG5hbWUgaXMgZ2l2ZW4sIGl0IHJldHVybnMgYWxsIHByZWRpY3Rpb25zIHdpdGggbW9kZWxzIG1hdGNoaW5nLlxuICAgICAqIE1vZGVsIG1hdGNoZXMgd2hlbiByYXcgbmFtZSAod2l0aG91dCB2ZXJzaW9uKSBpcyBtYXRjaGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFttb2RlbE5hbWVdXG4gICAgICogQHJldHVybnMge1ByZWRpY3Rpb25EZWZpbml0aW9uW119XG4gICAgICovXG4gICAgZ2V0UHJlZGljdGlvbnMobW9kZWxOYW1lKSB7XG4gICAgICAgIGNvbnN0IHNlcGFyYXRvciA9ICc6JztcbiAgICAgICAgaWYgKG1vZGVsTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJlZGljdGlvbnMuZmlsdGVyKHByZWQgPT4gcHJlZC5tb2RlbE5hbWUuc3BsaXQoc2VwYXJhdG9yKVswXSA9PT0gbW9kZWxOYW1lLnNwbGl0KHNlcGFyYXRvcilbMF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnByZWRpY3Rpb25zO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHJlc3BvbnNlIHN0YXR1cyAob25lIG9mOiBmYWlsdXJlLCBub3RfdXNlZCwgb25fdGltZSwgdGltZW91dCwgdG9vX2xhdGUgb3IgdW5kZWZpbmVkKTtcbiAgICAgKlxuICAgICAqIElmIGNhbGxJZCBpcyBub3Qgc3VwcGxpZWQsIHRoZSBsYXRlc3QgcmVzcG9uc2Ugd2l0aG91dCBhIHNwZWNpZmljIGtleSBpcyByZXR1cm5lZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gW2NhbGxJZF0gdmFsdWUgcGFzc2VkIGFzIGtleSBmb3IgY2FsbFxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0UmVzcG9uc2VTdGF0dXMoY2FsbElkKSB7XG4gICAgICAgIGNhbGxJZCA9IGNhbGxJZCB8fCB0aGlzLmNhbGxDb3VudGVyO1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXNlc1tjYWxsSWRdO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXJpYWxpemVzIGFsbCBwcmVkaWN0aW9uc1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gW2NhbGxJZF1cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNlcmlhbGl6ZShjYWxsSWQpIHtcbiAgICAgICAgbGV0IHsgcHJlZGljdGlvbnMgfSA9IHRoaXM7XG4gICAgICAgIGlmIChjYWxsSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcHJlZGljdGlvbnMgPSBwcmVkaWN0aW9ucy5maWx0ZXIocHJlZCA9PiBwcmVkLmNhbGxJZCA9PT0gY2FsbElkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHJlZGljdGlvbnNcbiAgICAgICAgICAgIC5tYXAocHJlZCA9PiBgJHtwcmVkLm1vZGVsTmFtZX18JHtwcmVkLmNhbGxJZH09JHtwcmVkLnJlc3VsdH1gKVxuICAgICAgICAgICAgLmpvaW4oJzsnKTtcbiAgICB9XG59XG5CaWxsVGhlTGl6YXJkLkZBSUxVUkUgPSAnZmFpbHVyZSc7XG5CaWxsVGhlTGl6YXJkLk5PVF9VU0VEID0gJ25vdF91c2VkJztcbkJpbGxUaGVMaXphcmQuT05fVElNRSA9ICdvbl90aW1lJztcbkJpbGxUaGVMaXphcmQuVElNRU9VVCA9ICd0aW1lb3V0JztcbkJpbGxUaGVMaXphcmQuVE9PX0xBVEUgPSAndG9vX2xhdGUnO1xuZXhwb3J0IGNvbnN0IGJpbGxUaGVMaXphcmQgPSBuZXcgQmlsbFRoZUxpemFyZCgpO1xuIiwiaW1wb3J0IHsgY29udGV4dCwgdXRpbHMgfSBmcm9tICdAd2lraWEvYWQtZW5naW5lJztcbmNvbnN0IGxvZ0dyb3VwID0gJ2dlby1lZGdlJztcbmNvbnN0IHNjcmlwdERvbWFpbklkID0gJ2QzYjAyZXN0bXV0ODc3Jztcbi8qKlxuICogSW5qZWN0cyBHZW8gRWRnZSBTaXRlIFNpZGUgUHJvdGVjdGlvbiBzY3JpcHRcbiAqIEByZXR1cm5zIHtQcm9taXNlfVxuICovXG5mdW5jdGlvbiBsb2FkU2NyaXB0KCkge1xuICAgIGNvbnN0IGdlb0VkZ2VMaWJyYXJ5VXJsID0gYC8vJHtzY3JpcHREb21haW5JZH0uY2xvdWRmcm9udC5uZXQvZ3J1bWktaXAuanNgO1xuICAgIHJldHVybiB1dGlscy5zY3JpcHRMb2FkZXIubG9hZFNjcmlwdChnZW9FZGdlTGlicmFyeVVybCwgJ3RleHQvamF2YXNjcmlwdCcsIHRydWUsICdmaXJzdCcpO1xufVxuLyoqXG4gKiBHZW9FZGdlIHNlcnZpY2UgaGFuZGxlclxuICovXG5jbGFzcyBHZW9FZGdlIHtcbiAgICAvKipcbiAgICAgKiBSZXF1ZXN0cyBzZXJ2aWNlIGFuZCBpbmplY3RzIHNjcmlwdCB0YWdcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjYWxsKCkge1xuICAgICAgICBjb25zdCBnZW9FZGdlS2V5ID0gY29udGV4dC5nZXQoJ3NlcnZpY2VzLmdlb0VkZ2UuaWQnKTtcbiAgICAgICAgY29uc3QgZ2VvRWRnZUNvbmZpZyA9IGNvbnRleHQuZ2V0KCdzZXJ2aWNlcy5nZW9FZGdlLmNvbmZpZycpO1xuICAgICAgICBpZiAoIWNvbnRleHQuZ2V0KCdzZXJ2aWNlcy5nZW9FZGdlLmVuYWJsZWQnKSB8fCAhZ2VvRWRnZUtleSkge1xuICAgICAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB1dGlscy5sb2dnZXIobG9nR3JvdXAsICdsb2FkaW5nJyk7XG4gICAgICAgIHdpbmRvdy5ncnVtaSA9IHtcbiAgICAgICAgICAgIGNmZzogZ2VvRWRnZUNvbmZpZyxcbiAgICAgICAgICAgIGtleTogZ2VvRWRnZUtleVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbG9hZFNjcmlwdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCAncmVhZHknKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0IGNvbnN0IGdlb0VkZ2UgPSBuZXcgR2VvRWRnZSgpO1xuIiwiaW1wb3J0IHsgY29udGV4dCwgdXRpbHMgfSBmcm9tICdAd2lraWEvYWQtZW5naW5lJztcbmNvbnN0IGxvZ0dyb3VwID0gJ2tydXgnO1xuLyoqXG4gKiBJbmplY3RzIEtydXggc2NyaXB0XG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAqL1xuZnVuY3Rpb24gbG9hZFNjcmlwdCgpIHtcbiAgICBjb25zdCBrcnV4SWQgPSBjb250ZXh0LmdldCgnc2VydmljZXMua3J1eC5pZCcpO1xuICAgIGNvbnN0IGtydXhMaWJyYXJ5VXJsID0gYC8vY2RuLmtyeGQubmV0L2NvbnRyb2x0YWc/Y29uZmlkPSR7a3J1eElkfWA7XG4gICAgcmV0dXJuIHV0aWxzLnNjcmlwdExvYWRlci5sb2FkU2NyaXB0KGtydXhMaWJyYXJ5VXJsLCAndGV4dC9qYXZhc2NyaXB0JywgdHJ1ZSwgJ2ZpcnN0Jywge1xuICAgICAgICBpZDogJ2tydXgtY29udHJvbC10YWcnXG4gICAgfSk7XG59XG4vKipcbiAqIEdldHMgS3J1eCBkYXRhIGZyb20gbG9jYWxTdG9yYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5XG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBnZXRLcnV4RGF0YShrZXkpIHtcbiAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgICByZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZVtrZXldO1xuICAgIH1cbiAgICBlbHNlIGlmICh3aW5kb3cubmF2aWdhdG9yLmNvb2tpZUVuYWJsZWQpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBkb2N1bWVudC5jb29raWUubWF0Y2goYCR7a2V5fT0oW147XSopYCk7XG4gICAgICAgIHJldHVybiAobWF0Y2ggJiYgZGVjb2RlVVJJKG1hdGNoWzFdKSkgfHwgJyc7XG4gICAgfVxuICAgIHJldHVybiAnJztcbn1cbndpbmRvdy5LcnV4ID0gd2luZG93LktydXggfHwgZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICB3aW5kb3cuS3J1eC5xLnB1c2goYXJncyk7XG59O1xud2luZG93LktydXgucSA9IHdpbmRvdy5LcnV4LnEgfHwgW107XG4vKipcbiAqIEtydXggc2VydmljZSBoYW5kbGVyXG4gKi9cbmNsYXNzIEtydXgge1xuICAgIC8qKlxuICAgICAqIFJlcXVlc3RzIHNlcnZpY2UsIHNhdmVzIHVzZXIgaWQgYW5kIHNlZ21lbnRzIGluIGNvbnRleHQgYW5kIGV4cG9ydHMgcGFnZSBsZXZlbCBwYXJhbXNcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjYWxsKCkge1xuICAgICAgICBpZiAoIWNvbnRleHQuZ2V0KCdzZXJ2aWNlcy5rcnV4LmVuYWJsZWQnKSB8fCAhY29udGV4dC5nZXQoJ29wdGlvbnMudHJhY2tpbmdPcHRJbicpKSB7XG4gICAgICAgICAgICB1dGlscy5sb2dnZXIobG9nR3JvdXAsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ2xvYWRpbmcnKTtcbiAgICAgICAgcmV0dXJuIGxvYWRTY3JpcHQoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZXhwb3J0UGFnZVBhcmFtcygpO1xuICAgICAgICAgICAgdGhpcy5pbXBvcnRVc2VyRGF0YSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhwb3J0IHBhZ2UgbGV2ZWwgcGFyYW1zIHRvIEtydXhcbiAgICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICAgKi9cbiAgICBleHBvcnRQYWdlUGFyYW1zKCkge1xuICAgICAgICBPYmplY3Qua2V5cyhjb250ZXh0LmdldCgndGFyZ2V0aW5nJykpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb250ZXh0LmdldChgdGFyZ2V0aW5nLiR7a2V5fWApO1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgd2luZG93W2BrcnV4RGFydFBhcmFtXyR7a2V5fWBdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbXBvcnRzIEtydXggZGF0YSBmcm9tIGxvY2FsU3RvcmFnZVxuICAgICAqIEByZXR1cm5zIHt2b2lkfVxuICAgICAqL1xuICAgIGltcG9ydFVzZXJEYXRhKCkge1xuICAgICAgICBjb25zdCB1c2VyID0gZ2V0S3J1eERhdGEoJ2t4dXNlcicpO1xuICAgICAgICBjb25zdCBzZWdtZW50cyA9IGdldEtydXhEYXRhKCdreHNlZ3MnKTtcbiAgICAgICAgY29udGV4dC5zZXQoJ3RhcmdldGluZy5rdWlkJywgdXNlciB8fCBudWxsKTtcbiAgICAgICAgY29udGV4dC5zZXQoJ3RhcmdldGluZy5rc2cnLCBzZWdtZW50cyA/IHNlZ21lbnRzLnNwbGl0KCcsJykgOiBbXSk7XG4gICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ2RhdGEgc2V0JywgdXNlciwgc2VnbWVudHMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIEtydXggdXNlciBJRFxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0VXNlcklkKCkge1xuICAgICAgICByZXR1cm4gY29udGV4dC5nZXQoJ3RhcmdldGluZy5rdWlkJykgfHwgbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBLcnV4IHNlZ21lbnRzXG4gICAgICogQHJldHVybnMge3N0cmluZ1tdfVxuICAgICAqL1xuICAgIGdldFNlZ21lbnRzKCkge1xuICAgICAgICByZXR1cm4gY29udGV4dC5nZXQoJ3RhcmdldGluZy5rc2cnKSB8fCBbXTtcbiAgICB9XG59XG5leHBvcnQgY29uc3Qga3J1eCA9IG5ldyBLcnV4KCk7XG4iLCJpbXBvcnQgeyBjb250ZXh0LCBldmVudHMsIHV0aWxzIH0gZnJvbSAnQHdpa2lhL2FkLWVuZ2luZSc7XG5jb25zdCBsb2dHcm91cCA9ICdtb2F0LXlpJztcbmV2ZW50cy5yZWdpc3RlckV2ZW50KCdNT0FUX1lJX1JFQURZJyk7XG4vKipcbiAqIEluamVjdHMgTU9BVCBZSSBzY3JpcHRcbiAqIEByZXR1cm5zIHtQcm9taXNlfVxuICovXG5mdW5jdGlvbiBsb2FkU2NyaXB0KCkge1xuICAgIGNvbnN0IHBhcnRuZXJDb2RlID0gY29udGV4dC5nZXQoJ3NlcnZpY2VzLm1vYXRZaS5wYXJ0bmVyQ29kZScpO1xuICAgIGNvbnN0IHVybCA9IGAvL3oubW9hdGFkcy5jb20vJHtwYXJ0bmVyQ29kZX0veWkuanNgO1xuICAgIHJldHVybiB1dGlscy5zY3JpcHRMb2FkZXIubG9hZFNjcmlwdCh1cmwsICd0ZXh0L2phdmFzY3JpcHQnLCB0cnVlLCAnZmlyc3QnKTtcbn1cbi8qKlxuICogTU9BVCBZSSBzZXJ2aWNlIGhhbmRsZXJcbiAqL1xuY2xhc3MgTW9hdFlpIHtcbiAgICAvKipcbiAgICAgKiBSZXF1ZXN0cyBNT0FUIFlJIHNlcnZpY2UgYW5kIHNhdmVzIHBhZ2UgbGV2ZWwgZGF0YSBpbiB0YXJnZXRpbmdcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjYWxsKCkge1xuICAgICAgICBpZiAoIWNvbnRleHQuZ2V0KCdzZXJ2aWNlcy5tb2F0WWkuZW5hYmxlZCcpIHx8ICFjb250ZXh0LmdldCgnc2VydmljZXMubW9hdFlpLnBhcnRuZXJDb2RlJykpIHtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG1vYXRZZWlsZFJlYWR5UmVzb2x2ZTtcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBtb2F0WWVpbGRSZWFkeVJlc29sdmUgPSByZXNvbHZlO1xuICAgICAgICB9KTtcbiAgICAgICAgdXRpbHMubG9nZ2VyKGxvZ0dyb3VwLCAnbG9hZGluZycpO1xuICAgICAgICB3aW5kb3cubW9hdFlpZWxkUmVhZHkgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmltcG9ydFBhZ2VQYXJhbXMoKTtcbiAgICAgICAgICAgIG1vYXRZZWlsZFJlYWR5UmVzb2x2ZSgpO1xuICAgICAgICB9O1xuICAgICAgICBjb250ZXh0LnNldCgndGFyZ2V0aW5nLm1fZGF0YScsICd3YWl0aW5nJyk7XG4gICAgICAgIGxvYWRTY3JpcHQoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ3JlYWR5Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBwYWdlIHBhcmFtcyB0byB0YXJnZXRpbmdcbiAgICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICAgKi9cbiAgICBpbXBvcnRQYWdlUGFyYW1zKCkge1xuICAgICAgICBpZiAod2luZG93Lm1vYXRQcmViaWRBcGkgJiYgdHlwZW9mIHdpbmRvdy5tb2F0UHJlYmlkQXBpLmdldE1vYXRUYXJnZXRpbmdGb3JQYWdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjb25zdCBwYWdlUGFyYW1zID0gd2luZG93Lm1vYXRQcmViaWRBcGkuZ2V0TW9hdFRhcmdldGluZ0ZvclBhZ2UoKSB8fCB7fTtcbiAgICAgICAgICAgIGNvbnRleHQuc2V0KCd0YXJnZXRpbmcubV9kYXRhJywgcGFnZVBhcmFtcy5tX2RhdGEpO1xuICAgICAgICAgICAgZXZlbnRzLmVtaXQoZXZlbnRzLk1PQVRfWUlfUkVBRFksIGBtX2RhdGE9JHtwYWdlUGFyYW1zLm1fZGF0YX1gKTtcbiAgICAgICAgICAgIHV0aWxzLmxvZ2dlcihsb2dHcm91cCwgJ21vYXRZaWVsZFJlYWR5JywgcGFnZVBhcmFtcyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnQgY29uc3QgbW9hdFlpID0gbmV3IE1vYXRZaSgpO1xuIiwiZXhwb3J0ICogZnJvbSAnLi9iaWxsLXRoZS1saXphcmQvaW5kZXgnO1xuZXhwb3J0ICogZnJvbSAnLi9nZW8tZWRnZS9pbmRleCc7XG5leHBvcnQgKiBmcm9tICcuL2tydXgvaW5kZXgnO1xuZXhwb3J0ICogZnJvbSAnLi9tb2F0LXlpL2luZGV4JztcbiJdLCJzb3VyY2VSb290IjoiIn0=