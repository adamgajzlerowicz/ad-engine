{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"babel-runtime/helpers/createClass\"","webpack://adEngine/external \"babel-runtime/helpers/classCallCheck\"","webpack://adEngine/external \"babel-runtime/helpers/inherits\"","webpack://adEngine/external \"babel-runtime/helpers/possibleConstructorReturn\"","webpack://adEngine/external \"babel-runtime/core-js/object/get-prototype-of\"","webpack://adEngine/external \"babel-runtime/core-js/object/keys\"","webpack://adEngine/external \"babel-runtime/helpers/slicedToArray\"","webpack://adEngine/external \"core-decorators\"","webpack://adEngine/external \"babel-runtime/core-js/object/get-own-property-descriptor\"","webpack://adEngine/external \"babel-runtime/core-js/promise\"","webpack://adEngine/external \"babel-runtime/core-js/object/assign\"","webpack://adEngine/./src/ad-bidders/base-bidder.js","webpack://adEngine/./src/ad-bidders/a9/index.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/base-adapter.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/aol.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus-ast.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus-webads.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/audience-network.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/beachfront.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/index-exchange.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/kargo.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/onemobile.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/openx.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/pubmatic.js","webpack://adEngine/./src/ad-bidders/prebid/prebid-helper.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon-display.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia-video.js","webpack://adEngine/./src/ad-bidders/prebid/adapters-registry.js","webpack://adEngine/./src/ad-bidders/prebid/price-helper.js","webpack://adEngine/./src/ad-bidders/prebid/prebid-settings.js","webpack://adEngine/./src/ad-bidders/prebid/index.js","webpack://adEngine/./src/ad-bidders/index.js"],"names":["name","bidderConfig","timeout","logGroup","resetState","onResponse","onResponseCall","utils","logger","callback","onResponseCallbacks","push","response","called","callBids","func","msToTimeout","resolve","reject","setTimeout","race","slotName","getBestPrice","isSlotSupported","getTargetingParams","isSupported","calculatePrices","start","makeLazyQueue","createWithTimeout","hasResponse","addResponseListener","loaded","isCMPEnabled","context","get","amazonId","slots","bids","priceMap","slotNamesMap","targetingKeys","forEach","amznbid","window","__cmp","consentData","init","insertScript","configureApstag","apsConfig","pubID","videoAdServer","deals","dealsEnabled","gdpr","enabled","gdprApplies","consent","cmpTimeout","apstag","a9Slots","map","createSlotDefinition","key","filter","slot","fetchBids","currentBids","bid","slotID","bidTargeting","keys","helpers","targeting","indexOf","_Q","args","configureApstagCommand","command","config","slotService","getState","slotId","definition","videoEnabled","type","mediaType","sizes","a9","a9Script","document","createElement","async","src","node","getElementsByTagName","parentNode","insertBefore","prepareConfigForAdUnit","options","bidderName","network","code","placement","alias","sizeId","mediaTypes","banner","bidder","params","placements","position","placementId","getPlacement","vertical","aliases","appnexus","debugPlacementId","isDebugMode","queryString","video","playerSize","skippable","playback_method","priority","testMode","bidfloor","debugAppId","appId","ix","siteId","size","pos","dcn","delDomain","unit","publisherId","ids","adSlot","lazyLoadSlots","isSlotApplicable","lazyLoad","isSlotLazy","setupAdUnits","adaptersConfig","adUnits","adapters","getAdapters","adapter","adapterAdUnits","prepareAdUnits","adUnit","getBidByAdId","adId","pbjs","getBidResponses","getAllPrebidWinningBids","length","responses","adUnitsBids","concat","getAvailableBidsByAdUnitCode","adUnitCode","getBidResponsesForAdUnitCode","status","getPrebid","getTargeting","getWinningVideoBidBySlotName","allowedBidders","canUseThisBidder","bidderCode","hasVast","vastUrl","vastContent","cpm","reduce","previousBid","currentBid","pushPrebid","que","accountId","zoneId","inventory","playerWidth","playerHeight","size_id","language","lang","rubicon","pageTargeting","keywords","create","supportedMediaTypes","price","parseInt","bidRequest","addBidResponse","done","addBids","createBid","width","height","bidResponse","ad","getCreative","getPrice","ttl","creative","style","background","color","fontFamily","textAlign","title","innerText","fontWeight","margin","paddingTop","details","join","appendChild","outerHTML","creativeId","customAdapters","availableAdapters","aol","appnexusAst","appnexusWebads","audienceNetwork","beachfront","indexExchange","kargo","onemobile","openx","pubmatic","rubiconDisplay","RubiconDisplay","registerAliases","aliasMap","aliasBidder","setupAdapters","bidders","setupCustomAdapters","wikia","wikiaVideo","registerBidAdapter","getPriorities","priorities","isValidPrice","getStatusCode","Prebid","validResponseStatusCode","DEFAULT_MAX_CPM","getPrebidBestPrice","bestPrices","slotBids","cpmPrice","transformPriceFromCpm","Math","max","parseFloat","toFixed","toString","maxCpm","result","floor","videoBiddersCap50","getSettings","standard","alwaysUseBid","adserverTargeting","val","includes","videoCacheKey","prebidLazyRun","method","apply","decorate","lazyLoaded","isLazyLoadingEnabled","lazyLoadingEnabled","bidsRefreshing","prebidConfig","debug","enableSendAllBids","bidderSequence","bidderTimeout","cache","url","userSync","iframeEnabled","enabledBidders","syncDelay","consentManagement","cmpApi","allowAuctionWithoutConsent","applyConfig","registerBidsRefreshing","setConfig","bidderSettings","bidsBackHandler","applySettings","requestBids","removeAdUnits","events","on","PREBID_LAZY_CALL","lazyCall","libraryUrl","script","adUnitsLazy","removeAdUnit","slotAlias","slotParams","bidParams","param","timeToRespond","hb_uuid","some","onEvent","winningBid","adUnitsToRefresh","withRemove","undefined","errorResponseStatusCode","biddersRegistry","realSlotPrices","applyTargetingParams","set","forEachBidder","getBidParameters","wasCalled","getSlotTargetingParams","getCurrentSlotPrices","slotPrices","priceFromBidder","getSlotBestPrice","getDfpSlotPrices","hasAllResponses","missingBidders","resetTargetingKeys","getTargetingKeysToReset","remove","responseListener","prebid","registerEvent","call","storeRealSlotPrices","updateSlotTargeting","bidderTargeting","prebidHelper"],"mappings":"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","file":"ad-bidders.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/inherits\");","module.exports = require(\"babel-runtime/helpers/possibleConstructorReturn\");","module.exports = require(\"babel-runtime/core-js/object/get-prototype-of\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/helpers/slicedToArray\");","module.exports = require(\"core-decorators\");","module.exports = require(\"babel-runtime/core-js/object/get-own-property-descriptor\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","import { utils } from '@wikia/ad-engine';\n\nexport class BaseBidder {\n\tconstructor(name, bidderConfig, timeout = 2000) {\n\t\tthis.name = name;\n\t\tthis.logGroup = `${name}-bidder`;\n\t\tthis.bidderConfig = bidderConfig;\n\t\tthis.timeout = timeout;\n\n\t\tthis.resetState();\n\t\tthis.onResponse = () => this.onResponseCall();\n\n\t\tutils.logger(this.logGroup, 'created');\n\t}\n\n\taddResponseListener(callback) {\n\t\tthis.onResponseCallbacks.push(callback);\n\t}\n\n\tcall() {\n\t\tthis.response = false;\n\t\tthis.called = true;\n\n\t\tif (this.callBids) {\n\t\t\tthis.callBids(this.onResponse);\n\t\t}\n\n\t\tutils.logger(this.logGroup, 'called');\n\t}\n\n\tcreateWithTimeout(func, msToTimeout = 2000) {\n\t\tconst timeout = new Promise((resolve, reject) => {\n\t\t\tsetTimeout(reject, msToTimeout);\n\t\t});\n\n\t\treturn Promise.race([new Promise(func), timeout]);\n\t}\n\n\tgetSlotBestPrice(slotName) {\n\t\tif (this.getBestPrice) {\n\t\t\treturn this.getBestPrice(slotName);\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetSlotTargetingParams(slotName) {\n\t\tif (!this.called || !this.isSlotSupported(slotName) || !this.getTargetingParams) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn this.getTargetingParams(slotName);\n\t}\n\n\thasResponse() {\n\t\treturn this.response;\n\t}\n\n\tisSlotSupported(slotName) {\n\t\tif (this.isSupported) {\n\t\t\treturn this.isSupported(slotName);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonResponseCall() {\n\t\tthis.response = true;\n\n\t\tif (this.calculatePrices) {\n\t\t\tthis.calculatePrices();\n\t\t}\n\n\t\tif (this.onResponseCallbacks) {\n\t\t\tthis.onResponseCallbacks.start();\n\t\t}\n\n\t\tutils.logger(this.logGroup, 'respond');\n\t}\n\n\tresetState() {\n\t\tthis.called = false;\n\t\tthis.response = false;\n\t\tthis.onResponseCallbacks = [];\n\n\t\tutils.makeLazyQueue(this.onResponseCallbacks, (callback) => {\n\t\t\tcallback(this.name);\n\t\t});\n\t}\n\n\twaitForResponse() {\n\t\treturn this.createWithTimeout((resolve) => {\n\t\t\tif (this.hasResponse()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.addResponseListener(resolve);\n\t\t\t}\n\t\t}, this.timeout);\n\t}\n\n\twasCalled() {\n\t\treturn this.called;\n\t}\n}\n","import { context, slotService } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\n\nlet loaded = false;\n\nexport class A9 extends BaseBidder {\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('a9', bidderConfig, timeout);\n\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.amazonId = this.bidderConfig.amazonId;\n\t\tthis.slots = this.bidderConfig.slots;\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tthis.slotNamesMap = {};\n\t\tthis.targetingKeys = [];\n\t\tthis.timeout = timeout;\n\t}\n\n\tcalculatePrices() {\n\t\tObject\n\t\t\t.keys(this.bids)\n\t\t\t.forEach((slotName) => {\n\t\t\t\tthis.priceMap[slotName] = this.bids[slotName].amznbid;\n\t\t\t});\n\t}\n\n\tcallBids(onResponse) {\n\t\tif (window.__cmp) {\n\t\t\twindow.__cmp('getConsentData', null, (consentData) => {\n\t\t\t\tthis.init(onResponse, consentData);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.init(onResponse);\n\t\t}\n\t}\n\n\tinit(onResponse, consentData = {}) {\n\t\tif (!loaded) {\n\t\t\tthis.insertScript();\n\t\t\tthis.configureApstag();\n\n\t\t\tconst apsConfig = {\n\t\t\t\tpubID: this.amazonId,\n\t\t\t\tvideoAdServer: 'DFP',\n\t\t\t\tdeals: !!this.bidderConfig.dealsEnabled\n\t\t\t};\n\n\t\t\tif (this.isCMPEnabled && consentData && consentData.consentData) {\n\t\t\t\tapsConfig.gdpr = {\n\t\t\t\t\tenabled: consentData.gdprApplies,\n\t\t\t\t\tconsent: consentData.consentData,\n\t\t\t\t\tcmpTimeout: 5000\n\t\t\t\t};\n\t\t\t}\n\n\t\t\twindow.apstag.init(apsConfig);\n\n\t\t\tloaded = true;\n\t\t}\n\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\n\t\tconst a9Slots = Object\n\t\t\t.keys(this.slots)\n\t\t\t.map(key => this.createSlotDefinition(key, this.slots[key]))\n\t\t\t.filter(slot => slot !== null);\n\n\t\twindow.apstag.fetchBids({\n\t\t\tslots: a9Slots,\n\t\t\ttimeout: this.timeout\n\t\t}, (currentBids) => {\n\t\t\tcurrentBids.forEach((bid) => {\n\t\t\t\tconst slotName = this.slotNamesMap[bid.slotID] || bid.slotID;\n\n\t\t\t\tlet bidTargeting = bid;\n\t\t\t\tlet keys = window.apstag.targetingKeys();\n\n\t\t\t\tif (this.bidderConfig.dealsEnabled) {\n\t\t\t\t\tkeys = bid.helpers.targetingKeys;\n\t\t\t\t\tbidTargeting = bid.targeting;\n\t\t\t\t}\n\n\t\t\t\tthis.bids[slotName] = {};\n\t\t\t\tkeys.forEach((key) => {\n\t\t\t\t\tif (this.targetingKeys.indexOf(key) === -1) {\n\t\t\t\t\t\tthis.targetingKeys.push(key);\n\t\t\t\t\t}\n\t\t\t\t\tthis.bids[slotName][key] = bidTargeting[key];\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tonResponse();\n\t\t});\n\t}\n\n\tconfigureApstag() {\n\t\twindow.apstag = window.apstag || {};\n\t\twindow.apstag._Q = window.apstag._Q || [];\n\n\t\tif (typeof window.apstag.init === 'undefined') {\n\t\t\twindow.apstag.init = (...args) => {\n\t\t\t\tthis.configureApstagCommand('i', args);\n\t\t\t};\n\t\t}\n\n\t\tif (typeof window.apstag.fetchBids === 'undefined') {\n\t\t\twindow.apstag.fetchBids = (...args) => {\n\t\t\t\tthis.configureApstagCommand('f', args);\n\t\t\t};\n\t\t}\n\t}\n\n\tconfigureApstagCommand(command, args) {\n\t\twindow.apstag._Q.push([command, args]);\n\t}\n\n\tcreateSlotDefinition(slotName, config) {\n\t\tif (!slotService.getState(slotName)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst slotID = config.slotId || slotName;\n\t\tconst definition = {\n\t\t\tslotID,\n\t\t\tslotName: slotID\n\t\t};\n\n\t\tthis.slotNamesMap[slotID] = slotName;\n\n\t\tif (!this.bidderConfig.videoEnabled && config.type === 'video') {\n\t\t\treturn null;\n\t\t} else if (config.type === 'video') {\n\t\t\tdefinition.mediaType = 'video';\n\t\t} else {\n\t\t\tdefinition.sizes = config.sizes;\n\t\t}\n\n\t\treturn definition;\n\t}\n\n\tgetBestPrice(slotName) {\n\t\treturn this.priceMap[slotName] ? { a9: this.priceMap[slotName] } : {};\n\t}\n\n\tgetPrices() {\n\t\treturn this.priceMap;\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn this.targetingKeys;\n\t}\n\n\tgetTargetingParams(slotName) {\n\t\treturn this.bids[slotName] || {};\n\t}\n\n\tinsertScript() {\n\t\tconst a9Script = document.createElement('script');\n\n\t\ta9Script.type = 'text/javascript';\n\t\ta9Script.async = true;\n\t\ta9Script.src = '//c.amazon-adsystem.com/aax2/apstag.js';\n\n\t\tconst node = document.getElementsByTagName('script')[0];\n\n\t\tnode.parentNode.insertBefore(a9Script, node);\n\t}\n\n\tisSupported(slotName) {\n\t\treturn !!this.slots[slotName];\n\t}\n}\n","export class BaseAdapter {\n\tconstructor({ enabled, slots }) {\n\t\tthis.enabled = enabled;\n\t\tthis.slots = slots;\n\t}\n\n\tprepareAdUnits() {\n\t\treturn Object\n\t\t\t.keys(this.slots)\n\t\t\t.map(\n\t\t\t\tslotName => this.prepareConfigForAdUnit(slotName, this.slots[slotName])\n\t\t\t);\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Aol extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'aol';\n\t\tthis.network = options.network;\n\t}\n\n\tprepareConfigForAdUnit(code, {\n\t\tsizes, placement, alias, sizeId\n\t}) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacement,\n\t\t\t\t\t\tnetwork: this.network,\n\t\t\t\t\t\talias,\n\t\t\t\t\t\tsizeId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { context } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Appnexus extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexus';\n\t\tthis.placements = options.placements;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, position = 'mobile' }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.getPlacement(position)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\tgetPlacement(position) {\n\t\tif (position === 'mobile') {\n\t\t\tconst vertical = context.get('targeting.mappedVerticalName');\n\n\t\t\tposition = vertical && this.placements[vertical] ? vertical : 'other';\n\t\t}\n\n\t\treturn this.placements[position];\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AppnexusAst extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexusAst';\n\t\tthis.aliases = {\n\t\t\tappnexus: [this.bidderName]\n\t\t};\n\t\tthis.debugPlacementId = options.debugPlacementId;\n\t\tthis.isDebugMode = utils.queryString.get('appnexusast_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480]\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.isDebugMode ? this.debugPlacementId : placementId,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tskippable: false,\n\t\t\t\t\t\t\tplayback_method: ['auto_play_sound_off']\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class AppnexusWebads extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexusWebAds';\n\t\tthis.aliases = {\n\t\t\tappnexus: [this.bidderName]\n\t\t};\n\t\tthis.priority = 0;\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId, sizes }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AudienceNetwork extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'audienceNetwork';\n\t\tthis.testMode = utils.queryString.get('audiencenetworktest') === 'true';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\ttestMode: this.testMode,\n\t\t\t\t\t\tplacementId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Beachfront extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'beachfront';\n\t\tthis.bidfloor = 0.01;\n\t\tthis.debugAppId = options.debugAppId;\n\t\tthis.isDebugMode = utils.queryString.get('beachfront_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { appId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480]\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tbidfloor: this.bidfloor,\n\t\t\t\t\t\tappId: this.isDebugMode ? this.debugAppId : appId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class IndexExchange extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'indexExchange';\n\t\tthis.aliases = {\n\t\t\tix: [this.bidderName]\n\t\t};\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: sizes.map(size => ({\n\t\t\t\tbidder: this.bidderName,\n\t\t\t\tparams: {\n\t\t\t\t\tsiteId,\n\t\t\t\t\tsize\n\t\t\t\t}\n\t\t\t}))\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\n\nexport class Kargo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'kargo';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tsizes,\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Onemobile extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'onemobile';\n\t\tthis.siteId = options.siteId;\n\t}\n\n\tprepareConfigForAdUnit(code, { size, pos }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes: [size]\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tdcn: this.siteId,\n\t\t\t\t\t\tpos\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Openx extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'openx';\n\t\tthis.delDomain = options.delDomain;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, unit }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tunit,\n\t\t\t\t\t\tdelDomain: this.delDomain\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Pubmatic extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'pubmatic';\n\t\tthis.publisherId = options.publisherId;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, ids }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: ids.map(adSlot => ({\n\t\t\t\tbidder: this.bidderName,\n\t\t\t\tparams: {\n\t\t\t\t\tadSlot,\n\t\t\t\t\tpublisherId: this.publisherId\n\t\t\t\t}\n\t\t\t}))\n\t\t};\n\t}\n}\n","import { context, slotService } from '@wikia/ad-engine';\nimport { getAdapters } from './adapters-registry';\n\nconst lazyLoadSlots = [\n\t'bottom_leaderboard'\n];\n\nfunction isSlotApplicable(code, lazyLoad) {\n\tconst isSlotLazy = lazyLoadSlots.indexOf(code) !== -1;\n\n\tif (!slotService.getState(code)) {\n\t\treturn false;\n\t}\n\n\tif (lazyLoad !== 'off' && ((lazyLoad === 'pre' && isSlotLazy) || (lazyLoad === 'post' && !isSlotLazy))) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function setupAdUnits(adaptersConfig, lazyLoad = 'off') {\n\tconst adUnits = [];\n\tconst adapters = getAdapters(adaptersConfig);\n\n\tadapters.forEach((adapter) => {\n\t\tif (adapter && adapter.enabled) {\n\t\t\tconst adapterAdUnits = adapter.prepareAdUnits();\n\n\t\t\tadapterAdUnits.forEach((adUnit) => {\n\t\t\t\tif (adUnit && isSlotApplicable(adUnit.code, lazyLoad)) {\n\t\t\t\t\tadUnits.push(adUnit);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\treturn adUnits;\n}\n\nexport function getBidByAdId(adId) {\n\tif (!window.pbjs || typeof window.pbjs.getBidResponses !== 'function') {\n\t\treturn null;\n\t}\n\n\tlet bids = window.pbjs.getAllPrebidWinningBids().filter(bid => adId === bid.adId);\n\n\tif (!bids.length) {\n\t\tconst responses = window.pbjs.getBidResponses();\n\n\t\tObject\n\t\t\t.keys(responses)\n\t\t\t.forEach((adUnit) => {\n\t\t\t\tconst adUnitsBids = responses[adUnit].bids.filter(bid => adId === bid.adId);\n\n\t\t\t\tbids = bids.concat(adUnitsBids);\n\t\t\t});\n\t}\n\n\treturn bids.length ? bids[0] : null;\n}\n\nexport function getAvailableBidsByAdUnitCode(adUnitCode) {\n\tlet bids = [];\n\n\tif (window.pbjs && typeof window.pbjs.getBidResponsesForAdUnitCode === 'function') {\n\t\tbids = window.pbjs.getBidResponsesForAdUnitCode(adUnitCode).bids || [];\n\t\tbids = bids.filter(bid => bid.status !== 'rendered');\n\t}\n\n\treturn bids;\n}\n\nexport function getPrebid() {\n\treturn window.pbjs;\n}\n\nexport function getTargeting(slotName) {\n\treturn Object.assign({\n\t\tpos: [slotName]\n\t}, context.get('bidders.prebid.targeting') || {});\n}\n\nexport function getWinningVideoBidBySlotName(slotName, allowedBidders) {\n\tif (!window.pbjs || !window.pbjs.getBidResponsesForAdUnitCode) {\n\t\treturn null;\n\t}\n\n\tconst bids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\treturn bids\n\t\t.filter((bid) => {\n\t\t\tconst canUseThisBidder = !allowedBidders || allowedBidders.indexOf(bid.bidderCode) !== -1;\n\t\t\tconst hasVast = bid.vastUrl || bid.vastContent;\n\n\t\t\treturn canUseThisBidder && hasVast && bid.cpm > 0;\n\t\t})\n\t\t.reduce((previousBid, currentBid) => {\n\t\t\tif (previousBid === null || currentBid.cpm > previousBid.cpm) {\n\t\t\t\treturn currentBid;\n\t\t\t}\n\n\t\t\treturn previousBid;\n\t\t}, null);\n}\n\nexport function pushPrebid(callback) {\n\twindow.pbjs.que.push(callback);\n}\n","import { context } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\nimport { getTargeting } from '../prebid-helper';\n\nexport class Rubicon extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon';\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, {\n\t\tsiteId, zoneId, sizeId, position\n\t}) {\n\t\tif (code === 'featured' && !context.get('custom.rubiconInFV')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst targeting = getTargeting(code);\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaType: 'video',\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480]\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tinventory: targeting,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tplayerWidth: '640',\n\t\t\t\t\t\t\tplayerHeight: '480',\n\t\t\t\t\t\t\tsize_id: sizeId,\n\t\t\t\t\t\t\tlanguage: targeting.lang ? targeting.lang[0] : 'en'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\nimport { getTargeting } from '../prebid-helper';\n\nexport class RubiconDisplay extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon_display';\n\t\tthis.aliases = {\n\t\t\trubicon: [this.bidderName]\n\t\t};\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, {\n\t\tsiteId, zoneId, sizes, position, targeting\n\t}) {\n\t\tconst pageTargeting = getTargeting(code);\n\n\t\tObject\n\t\t\t.keys(targeting || {})\n\t\t\t.forEach((key) => {\n\t\t\t\tpageTargeting[key] = targeting[key];\n\t\t\t});\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tkeywords: ['rp.fastlane'],\n\t\t\t\t\t\tinventory: pageTargeting\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n","import { context, utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Wikia extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikia';\n\t\tthis.enabled = !!(utils.queryString.get('wikia_adapter'));\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['banner']\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tconst price = context.get('bidders.prebid.wikia.price') || utils.queryString.get('wikia_adapter');\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tbidRequest.bids.forEach((bid) => {\n\t\t\tconst bidResponse = window.pbjs.createBid(1),\n\t\t\t\t[width, height] = bid.sizes[0];\n\n\t\t\tbidResponse.ad = this.getCreative(bid.sizes[0]);\n\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\tbidResponse.cpm = this.getPrice();\n\t\t\tbidResponse.ttl = 300;\n\t\t\tbidResponse.mediaType = 'banner';\n\t\t\tbidResponse.width = width;\n\t\t\tbidResponse.height = height;\n\n\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t});\n\t\tdone();\n\t}\n\n\tgetCreative(size) {\n\t\tconst creative = document.createElement('div');\n\n\t\tcreative.style.background = '#00b7e0';\n\t\tcreative.style.color = '#fff';\n\t\tcreative.style.fontFamily = 'sans-serif';\n\t\tcreative.style.height = '100%';\n\t\tcreative.style.textAlign = 'center';\n\t\tcreative.style.width = '100%';\n\n\t\tconst title = document.createElement('p');\n\n\t\ttitle.innerText = 'Wikia Creative';\n\t\ttitle.style.fontWeight = 'bold';\n\t\ttitle.style.margin = '0';\n\t\ttitle.style.paddingTop = '10px';\n\n\t\tconst details = document.createElement('small');\n\n\t\tdetails.innerText = `cpm: ${this.getPrice()}, size: ${size.join('x')}`;\n\n\t\tcreative.appendChild(title);\n\t\tcreative.appendChild(details);\n\n\t\treturn creative.outerHTML;\n\t}\n}\n","import { context, utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class WikiaVideo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikiaVideo';\n\t\tthis.enabled = !!(utils.queryString.get('wikia_video_adapter'));\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'outstream',\n\t\t\t\t\tplayerSize: [640, 480]\n\t\t\t\t}\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['video']\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tconst price = context.get('bidders.prebid.wikiaVideo.price') || utils.queryString.get('wikia_video_adapter');\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tbidRequest.bids.forEach((bid) => {\n\t\t\tconst bidResponse = window.pbjs.createBid(1),\n\t\t\t\t[width, height] = bid.sizes[0];\n\n\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\tbidResponse.cpm = this.getPrice();\n\t\t\tbidResponse.creativeId = 'foo123_wikiaVideoCreativeId';\n\t\t\tbidResponse.ttl = 300;\n\t\t\tbidResponse.mediaType = 'video';\n\t\t\tbidResponse.width = width;\n\t\t\tbidResponse.height = height;\n\n\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t});\n\t\tdone();\n\t}\n}\n","import { Aol } from './adapters/aol';\nimport { Appnexus } from './adapters/appnexus';\nimport { AppnexusAst } from './adapters/appnexus-ast';\nimport { AppnexusWebads } from './adapters/appnexus-webads';\nimport { AudienceNetwork } from './adapters/audience-network';\nimport { Beachfront } from './adapters/beachfront';\nimport { IndexExchange } from './adapters/index-exchange';\nimport { Kargo } from './adapters/kargo';\nimport { Onemobile } from './adapters/onemobile';\nimport { Openx } from './adapters/openx';\nimport { Pubmatic } from './adapters/pubmatic';\nimport { Rubicon } from './adapters/rubicon';\nimport { RubiconDisplay } from './adapters/rubicon-display';\nimport { Wikia } from './adapters/wikia';\nimport { WikiaVideo } from './adapters/wikia-video';\n\nconst adapters = [];\nconst customAdapters = [];\nconst availableAdapters = {\n\taol: Aol,\n\tappnexus: Appnexus,\n\tappnexusAst: AppnexusAst,\n\tappnexusWebads: AppnexusWebads,\n\taudienceNetwork: AudienceNetwork,\n\tbeachfront: Beachfront,\n\tindexExchange: IndexExchange,\n\tkargo: Kargo,\n\tonemobile: Onemobile,\n\topenx: Openx,\n\tpubmatic: Pubmatic,\n\trubicon: Rubicon,\n\trubiconDisplay: RubiconDisplay\n};\n\nfunction registerAliases() {\n\tadapters\n\t\t.filter(adapter => adapter.aliases)\n\t\t.forEach((adapter) => {\n\t\t\twindow.pbjs.que.push(() => {\n\t\t\t\tconst aliasMap = adapter.aliases;\n\n\t\t\t\tObject\n\t\t\t\t\t.keys(aliasMap)\n\t\t\t\t\t.forEach((bidderName) => {\n\t\t\t\t\t\taliasMap[bidderName].forEach((alias) => {\n\t\t\t\t\t\t\twindow.pbjs.aliasBidder(bidderName, alias);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n}\n\nfunction setupAdapters(bidders) {\n\tObject\n\t\t.keys(availableAdapters)\n\t\t.forEach((key) => {\n\t\t\tif (bidders[key]) {\n\t\t\t\tconst adapter = new availableAdapters[key](bidders[key]);\n\n\t\t\t\tadapters.push(adapter);\n\t\t\t}\n\t\t});\n\n\tsetupCustomAdapters(bidders);\n}\n\nfunction setupCustomAdapters(bidders) {\n\tif (bidders.wikia) {\n\t\tcustomAdapters.push(new Wikia(bidders.wikia));\n\t}\n\n\tif (bidders.wikiaVideo) {\n\t\tcustomAdapters.push(new WikiaVideo(bidders.wikiaVideo));\n\t}\n\n\tcustomAdapters.forEach((adapter) => {\n\t\tadapters.push(adapter);\n\n\t\twindow.pbjs.que.push(() => {\n\t\t\twindow.pbjs.registerBidAdapter(adapter.create, adapter.bidderName);\n\t\t});\n\t});\n}\n\nexport function getPriorities() {\n\tconst priorities = {};\n\n\tadapters.forEach((adapter) => {\n\t\tpriorities[adapter.bidderName] = adapter.priority || 1;\n\t});\n\n\treturn priorities;\n}\n\nexport function getAdapters(config) {\n\tif (adapters.length === 0 && config) {\n\t\tsetupAdapters(config);\n\t\tregisterAliases();\n\t}\n\n\treturn adapters;\n}\n","import { Prebid } from './index';\nimport { getAdapters } from './adapters-registry';\n\nfunction isValidPrice(bid) {\n\treturn bid.getStatusCode && bid.getStatusCode() === Prebid.validResponseStatusCode;\n}\n\nexport const DEFAULT_MAX_CPM = 20;\n\nexport function getPrebidBestPrice(slotName) {\n\tconst bestPrices = {};\n\n\tif (window.pbjs && window.pbjs.getBidResponsesForAdUnitCode) {\n\t\tconst slotBids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\t\tgetAdapters().forEach((adapter) => {\n\t\t\tbestPrices[adapter.bidderName] = '';\n\t\t});\n\n\t\tslotBids.forEach((bid) => {\n\t\t\tif (isValidPrice(bid) && bid.status !== 'rendered') {\n\t\t\t\tconst { bidderCode, cpm } = bid;\n\t\t\t\tconst cpmPrice = transformPriceFromCpm(cpm);\n\n\t\t\t\tbestPrices[bidderCode] = Math.max(bestPrices[bidderCode] || 0, parseFloat(cpmPrice)).toFixed(2).toString();\n\t\t\t}\n\t\t});\n\t}\n\n\treturn bestPrices;\n}\n\nexport function transformPriceFromCpm(cpm, maxCpm) {\n\tmaxCpm = maxCpm || DEFAULT_MAX_CPM;\n\tif (maxCpm < DEFAULT_MAX_CPM) {\n\t\tmaxCpm = DEFAULT_MAX_CPM;\n\t}\n\n\tlet result = Math.floor(maxCpm).toFixed(2);\n\n\tif (cpm === 0) {\n\t\tresult = '0.00';\n\t} else if (cpm < 0.05) {\n\t\tresult = '0.01';\n\t} else if (cpm < 5.00) {\n\t\tresult = (Math.floor(cpm * 20) / 20).toFixed(2);\n\t} else if (cpm < 10.00) {\n\t\tresult = (Math.floor(cpm * 10) / 10).toFixed(2);\n\t} else if (cpm < 20.00) {\n\t\tresult = (Math.floor(cpm * 2) / 2).toFixed(2);\n\t} else if (cpm < maxCpm) {\n\t\tresult = Math.floor(cpm).toFixed(2);\n\t}\n\n\treturn result;\n}\n","import { context } from '@wikia/ad-engine';\nimport { transformPriceFromCpm, DEFAULT_MAX_CPM } from './price-helper';\n\nconst videoBiddersCap50 = ['appnexusAst', 'rubicon', 'wikiaVideo']; // bidders with $50 cap\n\nexport function getSettings() {\n\treturn {\n\t\tstandard: {\n\t\t\talwaysUseBid: false,\n\t\t\tadserverTargeting: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_bidder',\n\t\t\t\t\tval: ({ bidderCode }) => bidderCode\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_adid',\n\t\t\t\t\tval: ({ adId }) => adId\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_pb',\n\t\t\t\t\tval: (bidResponse) => {\n\t\t\t\t\t\tlet maxCpm = DEFAULT_MAX_CPM;\n\t\t\t\t\t\tif (videoBiddersCap50.includes(bidResponse.bidderCode)) {\n\t\t\t\t\t\t\tmaxCpm = 50;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn transformPriceFromCpm(bidResponse.cpm, maxCpm);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_size',\n\t\t\t\t\tval: ({ size }) => size\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_uuid',\n\t\t\t\t\tval: bidResponse => (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tbidResponse.bidderCode === 'appnexusAst' && context.get('custom.appnexusDfp')\n\t\t\t\t\t\t) || (\n\t\t\t\t\t\t\tbidResponse.bidderCode === 'rubicon' && context.get('custom.rubiconDfp')\n\t\t\t\t\t\t) ? bidResponse.videoCacheKey : 'disabled'\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t};\n}\n","import { decorate } from 'core-decorators';\nimport { context, events, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\nimport { getPriorities } from './adapters-registry';\nimport { getPrebidBestPrice } from './price-helper';\nimport { getSettings } from './prebid-settings';\nimport { getAvailableBidsByAdUnitCode, setupAdUnits } from './prebid-helper';\n\nexport const prebidLazyRun = method => (...args) => window.pbjs.que.push(() => method.apply(this, args));\n\nconst logGroup = 'prebid';\n\nlet loaded = false;\n\nwindow.pbjs = window.pbjs || {};\nwindow.pbjs.que = window.pbjs.que || [];\n\nexport class Prebid extends BaseBidder {\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('prebid', bidderConfig, timeout);\n\n\t\tthis.insertScript();\n\n\t\tthis.lazyLoaded = false;\n\t\tthis.isLazyLoadingEnabled = this.bidderConfig.lazyLoadingEnabled;\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\tthis.bidsRefreshing = context.get('bidders.prebid.bidsRefreshing');\n\t\tthis.prebidConfig = {\n\t\t\tdebug: utils.queryString.get('pbjs_debug') === '1' || utils.queryString.get('pbjs_debug') === 'true',\n\t\t\tenableSendAllBids: true,\n\t\t\tbidderSequence: 'random',\n\t\t\tbidderTimeout: this.timeout,\n\t\t\tcache: {\n\t\t\t\turl: 'https://prebid.adnxs.com/pbc/v1/cache'\n\t\t\t},\n\t\t\tuserSync: {\n\t\t\t\tiframeEnabled: true,\n\t\t\t\tenabledBidders: [],\n\t\t\t\tsyncDelay: 6000\n\t\t\t}\n\t\t};\n\n\t\tif (this.isCMPEnabled) {\n\t\t\tthis.prebidConfig.consentManagement = {\n\t\t\t\tcmpApi: 'iab',\n\t\t\t\ttimeout: this.timeout,\n\t\t\t\tallowAuctionWithoutConsent: false\n\t\t\t};\n\t\t}\n\n\t\twindow.pbjs = window.pbjs || {};\n\t\twindow.pbjs.que = window.pbjs.que || [];\n\n\t\tthis.applyConfig(this.prebidConfig);\n\n\t\tif (this.bidsRefreshing && this.bidsRefreshing.enabled) {\n\t\t\tthis.registerBidsRefreshing();\n\t\t}\n\t}\n\n\tstatic validResponseStatusCode = 1;\n\tstatic errorResponseStatusCode = 2;\n\n\t@decorate(prebidLazyRun)\n\tapplyConfig(config) {\n\t\twindow.pbjs.setConfig(config);\n\t}\n\n\t@decorate(prebidLazyRun)\n\tapplySettings() {\n\t\twindow.pbjs.bidderSettings = getSettings();\n\t}\n\n\tcallBids(bidsBackHandler) {\n\t\tif (!this.adUnits) {\n\t\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\t}\n\n\t\tif (this.adUnits.length > 0) {\n\t\t\tthis.applySettings();\n\t\t\tthis.requestBids(this.adUnits, bidsBackHandler, this.removeAdUnits);\n\t\t}\n\n\t\tif (this.isLazyLoadingEnabled) {\n\t\t\tevents.on(events.PREBID_LAZY_CALL, () => {\n\t\t\t\tthis.lazyCall(bidsBackHandler);\n\t\t\t});\n\t\t}\n\t}\n\n\tinsertScript() {\n\t\tif (loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst libraryUrl = context.get('bidders.prebid.libraryUrl');\n\n\t\tif (!libraryUrl) {\n\t\t\tutils.logger(logGroup, 'Prebid library URL not defined. Assuming that window.pbjs will be loaded.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst script = document.createElement('script');\n\n\t\tscript.type = 'text/javascript';\n\t\tscript.async = true;\n\t\tscript.src = libraryUrl;\n\n\t\tconst node = document.getElementsByTagName('script')[0];\n\n\t\tnode.parentNode.insertBefore(script, node);\n\t\tloaded = true;\n\t}\n\n\tlazyCall(bidsBackHandler) {\n\t\tif (!this.lazyLoaded) {\n\t\t\tthis.lazyLoaded = true;\n\n\t\t\tconst adUnitsLazy = setupAdUnits(this.bidderConfig, 'post');\n\n\t\t\tif (adUnitsLazy.length > 0) {\n\t\t\t\tthis.requestBids(adUnitsLazy, bidsBackHandler);\n\n\t\t\t\tthis.adUnits = this.adUnits.concat(adUnitsLazy);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveAdUnits() {\n\t\t(window.pbjs.adUnits || []).forEach((adUnit) => {\n\t\t\twindow.pbjs.removeAdUnit(adUnit.code);\n\t\t});\n\t}\n\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\n\t\treturn getPrebidBestPrice(slotAlias);\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn [\n\t\t\t'hb_bidder',\n\t\t\t'hb_adid',\n\t\t\t'hb_pb',\n\t\t\t'hb_size',\n\t\t\t'hb_uuid'\n\t\t];\n\t}\n\n\tgetTargetingParams(slotName) {\n\t\tlet slotParams = {};\n\n\t\tconst slotAlias = context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\t\tconst bids = getAvailableBidsByAdUnitCode(slotAlias);\n\n\t\tif (bids.length) {\n\t\t\tlet bidParams = null;\n\t\t\tconst priorities = getPriorities();\n\n\t\t\tbids.forEach((param) => {\n\t\t\t\tif (!bidParams) {\n\t\t\t\t\tbidParams = param;\n\t\t\t\t} else if (bidParams.cpm === param.cpm) {\n\t\t\t\t\tif (priorities[bidParams.bidder] === priorities[param.bidder]) {\n\t\t\t\t\t\tbidParams = bidParams.timeToRespond > param.timeToRespond ? param : bidParams;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbidParams = priorities[bidParams.bidder] < priorities[param.bidder] ? param : bidParams;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbidParams = bidParams.cpm < param.cpm ? param : bidParams;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (bidParams) {\n\t\t\t\tslotParams = bidParams.adserverTargeting;\n\t\t\t}\n\n\t\t\t// ADEN-7436: AppNexus hb_uuid fix (adserverTargeting params are being set before cache key is returned)\n\t\t\tslotParams.hb_uuid = slotParams.hb_uuid || bidParams.videoCacheKey || 'disabled';\n\t\t}\n\n\t\treturn slotParams || {};\n\t}\n\n\tisSupported(slotName) {\n\t\tconst slotAlias = context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\n\t\treturn this.adUnits && this.adUnits.some(\n\t\t\tadUnit => adUnit.code === slotAlias\n\t\t);\n\t}\n\n\tregisterBidsRefreshing() {\n\t\twindow.pbjs.que.push(() => {\n\t\t\twindow.pbjs.onEvent('bidWon', (winningBid) => {\n\t\t\t\tif (this.bidsRefreshing.slots.indexOf(winningBid.adUnitCode) !== -1) {\n\t\t\t\t\tconst adUnitsToRefresh = this.adUnits.filter(\n\t\t\t\t\t\tadUnit => (\n\t\t\t\t\t\t\tadUnit.code === winningBid.adUnitCode &&\n\t\t\t\t\t\t\tadUnit.bids &&\n\t\t\t\t\t\t\tadUnit.bids[0] &&\n\t\t\t\t\t\t\tadUnit.bids[0].bidder === winningBid.bidderCode\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.requestBids(adUnitsToRefresh, this.bidsRefreshing.bidsBackHandler);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t@decorate(prebidLazyRun)\n\trequestBids(adUnits, bidsBackHandler, withRemove = undefined) {\n\t\tif (withRemove) {\n\t\t\twithRemove();\n\t\t}\n\n\t\twindow.pbjs.requestBids({\n\t\t\tadUnits,\n\t\t\tbidsBackHandler\n\t\t});\n\t}\n}\n","import { context, events, utils } from '@wikia/ad-engine';\nimport { A9 } from './a9';\nimport { Prebid } from './prebid';\nimport * as prebidHelper from './prebid/prebid-helper';\n\nconst biddersRegistry = {};\nconst realSlotPrices = {};\nconst logGroup = 'bidders';\n\nfunction applyTargetingParams(slotName, targeting) {\n\tObject\n\t\t.keys(targeting)\n\t\t.forEach(\n\t\t\tkey => context.set(`slots.${slotName}.targeting.${key}`, targeting[key])\n\t\t);\n}\n\nfunction forEachBidder(callback) {\n\tObject\n\t\t.keys(biddersRegistry)\n\t\t.forEach((bidderName) => {\n\t\t\tcallback(biddersRegistry[bidderName]);\n\t\t});\n}\n\nfunction getBidParameters(slotName) {\n\tconst slotParams = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.wasCalled()) {\n\t\t\tconst params = bidder.getSlotTargetingParams(slotName);\n\n\t\t\tObject\n\t\t\t\t.keys(params)\n\t\t\t\t.forEach((key) => {\n\t\t\t\t\tslotParams[key] = params[key];\n\t\t\t\t});\n\t\t}\n\t});\n\n\treturn slotParams;\n}\n\nfunction getCurrentSlotPrices(slotName) {\n\tconst slotPrices = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.isSlotSupported(slotName)) {\n\t\t\tconst priceFromBidder = bidder.getSlotBestPrice(slotName);\n\n\t\t\tObject\n\t\t\t\t.keys(priceFromBidder)\n\t\t\t\t.forEach((bidderName) => {\n\t\t\t\t\tslotPrices[bidderName] = priceFromBidder[bidderName];\n\t\t\t\t});\n\t\t}\n\t});\n\n\treturn slotPrices;\n}\n\nfunction getDfpSlotPrices(slotName) {\n\treturn realSlotPrices[slotName] || {};\n}\n\nfunction hasAllResponses() {\n\tconst missingBidders = Object\n\t\t.keys(biddersRegistry)\n\t\t.filter((bidderName) => {\n\t\t\tconst bidder = biddersRegistry[bidderName];\n\n\t\t\treturn !bidder.hasResponse();\n\t\t});\n\n\treturn missingBidders.length === 0;\n}\n\nfunction resetTargetingKeys(slotName) {\n\tforEachBidder((bidder) => {\n\t\tbidder.getTargetingKeysToReset().forEach((key) => {\n\t\t\tcontext.remove(`slots.${slotName}.targeting.${key}`);\n\t\t});\n\t});\n\n\tutils.logger(logGroup, 'resetTargetingKeys', slotName);\n}\n\nfunction requestBids({ responseListener = null }) {\n\tconst config = context.get('bidders');\n\n\tif (config.prebid && config.prebid.enabled) {\n\t\tif (!events.PREBID_LAZY_CALL) {\n\t\t\tevents.registerEvent('PREBID_LAZY_CALL');\n\t\t}\n\n\t\tbiddersRegistry.prebid = new Prebid(config.prebid, config.timeout);\n\t}\n\n\tif (config.a9 && config.a9.enabled) {\n\t\tbiddersRegistry.a9 = new A9(config.a9, config.timeout);\n\t}\n\n\tforEachBidder((bidder) => {\n\t\tif (responseListener) {\n\t\t\tbidder.addResponseListener(responseListener);\n\t\t}\n\n\t\tbidder.call();\n\t});\n}\n\nfunction storeRealSlotPrices(slotName) {\n\trealSlotPrices[slotName] = getCurrentSlotPrices(slotName);\n}\n\nfunction updateSlotTargeting(slotName) {\n\tconst bidderTargeting = getBidParameters(slotName);\n\n\tstoreRealSlotPrices(slotName);\n\n\tresetTargetingKeys(slotName);\n\tapplyTargetingParams(slotName, bidderTargeting);\n\n\tutils.logger(logGroup, 'updateSlotTargeting', slotName, bidderTargeting);\n\n\treturn bidderTargeting;\n}\n\nexport const bidders = {\n\tgetCurrentSlotPrices,\n\tgetDfpSlotPrices,\n\thasAllResponses,\n\tprebidHelper,\n\trequestBids,\n\tupdateSlotTargeting\n};\n"],"sourceRoot":""}